!function(){"use strict";function a(e){e=e||{};this.title=e.title,this.thumbnail=e.thumbnail,this.url=e.url,this.format=e.format,this.downloadId=e.downloadId,this.provider=e.provider,this.providerLink=e.providerLink,this.photographer=e.photographer,this.photographerLink=e.photographerLink,this.thumbnailHeight=0}function t(e){this.options=p.extend({name:"abstract",url:"",apiKey:"",freeLimit:-1},e),this.providerName=this.options.name,this.result=[],this.keywords="",this.imgWidth=90,this.proxy={enable:!0,url:"/infographics/proxy_search"}}function r(e){e=p.extend({url:"https://api.flickr.com/services/rest/"},e);t.call(this,e)}function o(e){e=p.extend({url:"https://api.pexels.com/v1/"},e);t.call(this,e)}function i(e){e=p.extend({url:"http://pixabay.com/api/"},e);t.call(this,e)}function n(e){e=p.extend({unsplashURL:"https://api.unsplash.com/search/photos",showMore:!1},e);t.call(this,e)}function s(e){e=p.extend({pexelsURL:"https://api.pexels.com/v1/search",showMore:!1},e);t.call(this,e)}var p;window.Viz=window.Viz||{},window.Viz.searchProvider=(p=jQuery,t.prototype.clearResult=function(){this.result=[]},t.prototype.randomizeResult=function(e){for(var t,r,o=e.length;o;)r=Math.floor(Math.random()*o--),t=e[o],e[o]=e[r],e[r]=t;return e},t.prototype.proxySearchPixabay=function(t,r,o){var n=this;p.ajax({type:"GET",url:this.proxy.url+"_pixabay",data:{keywords:t.keywords,per_page:t.per_page,page:t.page}}).done(function(e){1==t.page&&n.clearResult(),n.options.showMore=e&&parseInt(e.totalHits/t.per_page)>=t.page;var i=[];e&&0<e.totalHits&&p.each(e.hits,function(e,t){var r=new a({title:t.tags,thumbnail:t.previewURL,url:t.webformatURL,format:"jpeg",provider:"Pixabay",providerLink:"https://pixabay.com/"}),o=t.previewHeight/(t.previewWidth/n.imgWidth);r.thumbnailHeight=o,i.push(r)}),n.result.push(i),"function"==typeof o?o(r):"function"!=typeof o&&0==i.length?r([]):r(i)}).error(function(){n.options.showMore=!1,"function"==typeof o?(1==t.page&&n.clearResult(),n.result.push([]),o(r)):r([],window.__vg_translator.t("editor.misc.internal_error"))})},t.prototype.proxySearchPexels=function(i,t){var n=this;p.ajax({type:"GET",url:this.proxy.url+"_pexels",data:{keywords:i.keywords,per_page:i.per_page,page:i.page}}).done(function(e){e&&0<e.photos.length&&p.each(e.photos,function(e,t){var r=new a({title:"Pexels Photo",thumbnail:t.src.small,url:t.src.large,format:"jpeg",provider:"Pexels",providerLink:"https://www.pexels.com/",photographer:t.photographer,photographerLink:t.photographer_url}),o=t.height/(t.width/n.imgWidth);r.thumbnailHeight=o,n.result[i.page-1].push(r)}),0<n.result[i.page-1].length?(n.randomizeResult(n.result[i.page-1]),t(n.result[i.page-1])):t([]),n.keywords=i.keywords}).error(function(){0<n.result[i.page-1].length?t(n.result[i.page-1]):t([],window.__vg_translator.t("editor.misc.internal_error"))})},t.prototype.proxySearchUnsplash=function(i,t){var n=this;p.ajax({type:"GET",url:this.proxy.url+"_unsplash/search/false",data:{keywords:i.keywords,per_page:i.per_page,page:i.page}}).done(function(e){n.options.showMore=e&&(n.options.showMore||e.total_pages>i.page),e&&0<e.results.length&&p.each(e.results,function(e,t){var r=new a({title:t.description,thumbnail:t.urls.thumb,url:t.urls.regular,format:"jpeg",downloadId:t.id,provider:"Unsplash",providerLink:"https://unsplash.com/",photographer:t.user.name,photographerLink:t.user.links.html}),o=t.height/(t.width/n.imgWidth);r.thumbnailHeight=o,n.result[i.page-1].push(r)}),0<n.result[i.page-1].length?(n.randomizeResult(n.result[i.page-1]),t(n.result[i.page-1])):t([]),n.keywords=i.keywords}).error(function(){0<n.result[i.page-1].length?t(n.result[i.page-1]):t([],window.__vg_translator.t("editor.misc.internal_error"))})},(r.prototype=Object.create(t.prototype)).query=function(t,n){var s=this;p.ajax({url:this.options.url,data:{format:"json",method:"flickr.interestingness.getList",api_key:this.options.apiKey},dataType:"jsonp",jsonp:"jsoncallback"}).done(function(e){var i;e.photos?(s.clearResult(),i=e.photos.photo.length,p.each(e.photos.photo,function(e,t){var r="https://farm"+t.farm+".static.flickr.com/"+t.server+"/"+t.id+"_"+t.secret,o=new a({title:t.title,thumbnail:r+"_s.jpg",url:r+"_b.jpg",format:"jpeg"});s.result.push(o),e==i-1&&n(s.result)})):n([]),s.keywords=t})},(o.prototype=Object.create(t.prototype)).query=function(e,t,r){var o={per_page:50,keywords:e,page:t};this.proxySearchPexels(o,r)},(i.prototype=Object.create(t.prototype)).query=function(t,e,i){var n,r,o,s={per_page:50,keywords:t,page:e};this.proxy.enable?this.proxySearchPixabay(s,i):(n=this,r=p.param({username:this.options.username,key:this.options.apiKey,per_page:50,q:t}),o=this.options.url+"?"+r,p.getJSON(o,function(e){var o;0<parseInt(e.totalHits)?(n.clearResult(),o=e.hits.length,p.each(e.hits,function(e,t){var r=new a({title:t.tags,thumbnail:t.previewURL,url:t.webformatURL,format:"jpeg"});n.result.push(r),e==o-1&&i(n.result)})):i([]),n.keywords=t}))},(n.prototype=Object.create(t.prototype)).query=function(e,t,r){var o=this,i={per_page:25,keywords:e,page:t};this.proxy.enable&&o.proxySearchPixabay(i,r,function(e){o.proxySearchUnsplash(i,e)})},(s.prototype=Object.create(t.prototype)).query=function(e,t,r){var o=this,i={per_page:25,keywords:e,page:t};this.proxy.enable&&o.proxySearchPixabay(i,r,function(e){o.proxySearchPexels(i,e)})},{SearchProvider:t,getInstance:function(e){switch(e.name){case"flickr":return new r(e);case"pixabay":return new i(e);case"pixabay-unsplash":return new n(e);case"pexels":return new o(e);case"pixabay-pexels":return new s(e);default:return new t(e)}}})}(),function(){"use strict";function e(e,t){this.resultContainer=null,this.loadingIconContainer=null,this.columnContainerLeft=null,this.columnContainerRight=null,this.refreshIcon=n('<span class="glyphicon glyphicon-refresh image-container-refresh" />'),this.options={lastSearch:"",limit:100,page:1,item:{wrapper:"<span />",cssClass:"widget-draggable search-photo",type:"search-photo",dragOption:{revert:!1,helper:"clone",appendTo:"body",zIndex:9999,cursor:"move",start:function(e,t){var r=n(t.helper).find("img").get(0);n(r).css({"max-height":"100%","max-width":"100%",width:"auto"}),t.helper.css({padding:"5px"}),t.helper.find(".img-spacer").css({display:"inline-block",width:"1px",height:"100%","vertical-align":"middle","margin-left":"-4px"})}},dropOption:{}},providerName:""},this.keywords="",this.searchProvider=t||null,this.initialize(e)}function o(){s.resultContainer.parent().find("#image_search").val(""),s.resultContainer.parent().find(".clear-search-box").remove(),s.keywords="",s.options.lastSearch="",s.searchProvider.keywords="",s.columnContainerLeft.empty(),s.columnContainerRight.empty(),s.resultContainer.siblings(".image-search-footer").addClass("hidden"),s.resultContainer.siblings(".image-search-show-more").remove(),s.resultContainer.siblings(".no-results").remove(),s.options.page=1,s.options.columnHeightLeft=0,s.options.columnHeightRight=0}var n,t,s;window.Viz=window.Viz||{},window.Viz.ImageSearch=(n=jQuery,t=Viz.searchProvider,e.prototype.search=function(e,t){var r;this.keywords=e,"undefined"!==this.keywords&&0<this.keywords.length&&((s=this).options.columnHeightLeft=0,s.options.columnHeightRight=0,s.resultContainer.parent().find(".clear-search-box").remove(),s.resultContainer.siblings(".image-search-show-more").remove(),s.resultContainer.siblings(".no-results").remove(),r=n("<a />").addClass("clear-search-box").click(o),n(s.resultContainer).parent().find(".search-input-box").append(r),s.columnContainerLeft.html(""),s.columnContainerRight.html(""),s.loadingIconContainer.show(),s.searchProvider.query(s.keywords,s.options.page,function(e,t){var r;s.buildResults(e,t),s.searchProvider.options.showMore&&(r=n('<a class="image-search-show-more">').text(window.__vg_translator.t("editor.misc.showMore")),s.resultContainer.siblings(".image-search-footer").before(r.click(function(){s.options.page++,n(this).empty().addClass("refresh").append(s.refreshIcon).off("click"),s.searchProvider.query(s.keywords,s.options.page,function(e,t){s.buildResults(e,t)})}))),n("#editor_nav .side-menu-container").scrollTop(305)}))},e.prototype.initialize=function(e){this.options=n.extend(!0,this.options,e),null===this.options.container||"undefined"===this.options.container?this.resultContainer=n("<div></div>"):(this.resultContainer=n("#"+this.options.container),this.columnContainerLeft=this.resultContainer.children(".left"),this.columnContainerRight=this.resultContainer.children(".right")),this.loadingIconContainer=this.resultContainer.siblings(".loadingContainer"),null!==this.searchProvider&&"undefined"!==this.searchProvider||this.setProvider(t.getInstance({name:"google"}))},e.prototype.getResultContainer=function(){return this.resultContainer},e.prototype.setProvider=function(e){if(!(e instanceof t.SearchProvider))throw new Error("invalid search provider");this.searchProvider=e},e.prototype.buildResults=function(e,t){t=t||!1,s.loadingIconContainer.hide(),n.each(e,function(e,t){if("rope, sexy, lady"==t.title)return!0;var r={};r.downloadId=t.downloadId,r.photographer=t.photographer,r.photographerLink=t.photographerLink,r.provider=t.provider,r.providerLink=t.providerLink;var o,i=n("<img>").prop("src",t.thumbnail);s.options.columnHeightRight<s.options.columnHeightLeft?(o=s.columnContainerRight,s.options.columnHeightRight+=t.thumbnailHeight+10):(o=s.columnContainerLeft,s.options.columnHeightLeft+=t.thumbnailHeight+10),n(s.options.item.wrapper).append(i).data("photoData",r).attr("data-widget-type",s.options.item.type).attr("data-widget-url",t.url).addClass(s.options.item.cssClass).draggable(s.options.item.dragOption).disableSelection().appendTo(o)}),0==e.length?(s.resultContainer.siblings(".image-search-footer").addClass("hidden"),t&&(s.keywords="",s.options.lastSearch="",s.searchProvider.keywords=""),s.resultContainer.after(n('<li class="no-results">'+(t||window.__vg_translator.t("editor.misc.no_results"))+"</li>"))):(s.resultContainer.siblings(".image-search-footer").html('<p>Photos from <a href="https://pixabay.com/">Pixabay</a> and <a href="https://pexels.com">Pexels</a></p>'),s.resultContainer.siblings(".image-search-footer").removeClass("hidden")),s.searchProvider.options.showMore?1<s.options.page&&s.resultContainer.siblings(".image-search-show-more").removeClass("refresh").empty().text(window.__vg_translator.t("editor.misc.showMore")).click(function(){s.options.page++,n(this).empty().addClass("refresh").append(s.refreshIcon).off("click"),s.searchProvider.query(s.keywords,s.options.page,function(e,t){s.buildResults(e,t)})}):s.resultContainer.siblings(".image-search-show-more").remove(),reInitSideBar()},e)}();
!function(){"use strict";window.Viz=window.Viz||{},window.Viz.ImageUpload=function(s){var e=function(e,t,a){this.columnContainerLeft=null;this.columnContainerRight=null;this.page=1;this.data=[];this.columnHeightLeft=0;this.columnHeightRight=0;this.mediaCount=0;this.uploadDirection="left";this.options={limit:100,page:1,enableMediaCounter:false,mediaMaxLimit:mediaMaxLimit};this.usermediaContainerElm=null;this.initialize(e,t,a)};e.prototype.initialize=function(e,t,a){this.options=s.extend(true,this.options,e);this.data=t;this.callback=a;this.mediaCount=t.length;this.usermediaContainerElm=document.getElementById(this.options.containerId);this.columnContainerLeft=this.usermediaContainerElm.querySelector(".left");this.columnContainerRight=this.usermediaContainerElm.querySelector(".right");this.columnHeightLeft=0;this.columnHeightRight=0;this.render();r.apply(this)},e.prototype.render=function(e){var t=this.options.limit;var a=(this.page-1)*t;var i=Math.min(a+t,this.data.length)-1;for(var o=a;o<=i;o+=1){n.apply(this,[o])}r.apply(this);this.callback()},e.prototype.getMediaCount=function(){return this.mediaCount},e.prototype.increaseMediaCount=function(){this.mediaCount+=1;this.renderMediaCounter()},e.prototype.decreaseMediaCount=function(){this.mediaCount-=1;this.renderMediaCounter()},e.prototype.activateDeleteUserMediaButton=function(){m.apply(this)},e.prototype.uploadImage=function(e,t,a,i){var r=this;r.uploadDirection=r.columnHeightLeft<r.columnHeightRight?"left":"right";if(!u(t)){return}var o=new FileReader;o.readAsDataURL(t);var n=s("#user_media_library_list .loadingContainer");n.show();var l=document.getElementById("upload_filename").value;if(a){r.increaseMediaCount()}else if(!a&&l){s.ajaxFileUpload({url:"/usermedialibrary/upload",secureuri:false,fileElementId:"upload_filename",dataType:"json",success:function(e,t){n.hide();var a="https://s3.amazonaws.com/"+userMediaBucket+e.file_id;r.renderUploadedImage(a,e.original_name);var i=s("#user_media_library_list #"+e.original_name.replace(/[^a-zA-Z0-9]/g,""));i.attr("data-widget-url",a);var o=new Image;o.onload=function(){m.apply(r);i.removeAttr("id");r.callback()};o.src=a;VGEditor.setting.imageUploadsUpdating()},error:function(e,t){n.hide();r.decreaseMediaCount()}});r.increaseMediaCount()}else{n.hide()}var d=document.getElementById("upload_filename");if(d!=null){d.outerHTML=d.outerHTML;document.getElementById("upload_filename").addEventListener("change",function(e){var t=e.target.files[0];r.uploadImage(e,t,false);VGEditor.track.mixpanel("Image Uploaded");VGEditor.track.intercom("trackEvent","Image Uploaded");document.getElementById("upload_filename").value=""})}if(r.uploadDirection==="left"){r.columnHeightLeft+=1}else if(r.uploadDirection==="right"){r.columnHeightRight+=1}},e.prototype.renderMediaCounter=function(){if(this.options.enableMediaCounter){var t=this;s(".media-upload-counter").each(function(e){s(this).removeClass("media-upload-count-max");s(this).removeClass("media-upload-count-fill");if(t.mediaCount>t.options.mediaMaxLimit-1){s(this).addClass("media-upload-count-max")}else if(e<t.mediaCount){s(this).addClass("media-upload-count-fill")}});if(t.mediaCount>t.options.mediaMaxLimit-1){s("#user_media_upload_button").text(window.__vg_translator.t("editor.imageUploads.upgrade"));s("#user_media_upload_button").addClass("button-upload-upgrade");s("#user_media_upload_button").unbind("click");s("#user_media_upload_button").click(function(){window.save_upgrade_people_props({feature:"Image Upload Limit "+t.options.mediaMaxLimit});VGEditor.track.mixpanel("Click On Upgrade",{"Button Number":"media library button",Feature:"Image Upload Limit "+t.options.mediaMaxLimit});VGEditor.track.intercom("trackEvent","Click On Upgrade",{"Button Number":"media library button",Feature:"Image Upload Limit "+t.options.mediaMaxLimit});sessionStorage.setItem("mixpanel_feature",JSON.stringify({data:{Feature:"Image Upload Limit "+t.options.mediaMaxLimit}}));window.location.href="/account/subscription"+(allowPremiumWidgets?"/business":"")});s("#drag_drop_upload_box").unbind("click");s("#drag_drop_upload_box").text(window.__vg_translator.t("editor.imageUploads.maxImageMsg"));s("#drag_drop_upload_box").addClass("drag-drop-upload-disabled")}else{s("#user_media_upload_button").text(window.__vg_translator.t("editor.imageUploads.uploadImage"));s("#user_media_upload_button").removeClass("button-upload-upgrade");s("#user_media_upload_button").unbind("click");s("#drag_drop_upload_box").unbind("click");s("#drag_drop_upload_box").html("<span>"+window.__vg_translator.t("editor.imageUploads.drag1")+"</span><br />"+window.__vg_translator.t("editor.imageUploads.drag2"));s("#drag_drop_upload_box").removeClass("drag-drop-upload-disabled");s("#drag_drop_upload_box").click(function(){s("#upload_filename").click();VGEditor.track.mixpanel("Click drag and drop box");s("#upload_filename")[0].value=""});s("#user_media_upload_button").click(function(){s("#upload_filename").click();VGEditor.track.mixpanel("Upload from CTA");s("#upload_filename")[0].value=""})}}},e.prototype.renderUploadedImage=function(e,t){s("#user-media-result .user-media-column."+this.uploadDirection).prepend('<div id="'+t.replace(/[^a-zA-Z0-9]/g,"")+'" data-widget-type="user-media-image" class="user-media-image-thumbnail widget-draggable ui-draggable ui-draggable-handle"'+'" style="margin: 10px auto; height: auto; padding: 0px; min-height: 32px; display: flex; overflow: hidden; max-height: 120px; align-item: center; image-orientation: from-image;">'+'<img src="'+e+'" style="width: 100%; height: 100%; border: 1px solid rgb(195, 195, 195); min-height: unset">'+' <div class="delete-user-media-icon" data-toggle="tooltip" data-placement="bottom" data-trigger="hover" data-original-title="'+window.__vg_translator.t("editor.imageUploads.remove")+'"><i class="flaticon-trash normalized"></i></a></div>')};var r=function(){var e=document.querySelector("#user_media_library_list .user-media-show-more");var t=!!e;var a=this.options.limit*this.page;if(this.data.length<=a){if(t){e.parentNode.removeChild(e)}return}if(!t){var i=document.createElement("a");i.className="user-media-show-more";i.innerHTML=window.__vg_translator.t("editor.misc.showMore");this.usermediaContainerElm.parentNode.append(i);var o=this;i.addEventListener("click",function(){o.page++;o.render()})}},n=function(e){var a=this;var t=a.data[e];var i="https://s3.amazonaws.com/"+userMediaBucket+"/"+t.media_id;var o=document.createElement("div");o.className="user-media-image-thumbnail widget-draggable ui-draggable ui-draggable-handle";o.setAttribute("data-widget-url",i);o.setAttribute("data-widget-type","user-media-image");var r=document.createElement("img");r.setAttribute("data-widget-url",i);r.src=i;var n=null;n=a.columnHeightLeft<a.columnHeightRight?a.columnContainerLeft:a.columnContainerRight;n.appendChild(o);o.appendChild(r);r.onload=function(){o.style.minHeight="32px";r.style.minHeight="unset";var e=document.createElement("div");e.setAttribute("data-toggle","tooltip");e.setAttribute("data-placement","bottom");e.setAttribute("data-container","body");e.setAttribute("data-original-title","Remove");e.className="delete-user-media-icon";var t=document.createElement("i");t.className="flaticon-trash normalized";o.appendChild(e);e.appendChild(t);a.callback();m.apply(a)};if(n===a.columnContainerLeft){a.columnHeightLeft+=1}else if(n===a.columnContainerRight){a.columnHeightRight+=1}},u=function(e){var t=/^image\/(p?jpeg|gif|png)/;var a=["png","jpg","gif","jpeg"];var i=e.name.split(".").pop().toLowerCase();if(!e)return false;if(!t.test(e.type)||a.indexOf(i)<0){create_simple_modal(null,"error_modal",window.__vg_translator.t("editor.imageUploads.errorNotSupported"),window.__vg_translator.t("editor.imageUploads.errorFormat"),null,null,null);return false}if(e.size>1024*1024*5){create_simple_modal(null,"error_modal",window.__vg_translator.t("editor.imageUploads.errorTooLarge"),window.__vg_translator.t("editor.imageUploads.errorImageSize"),null,null,null);return false}return true};e.prototype.validateFile=u;var m=function(){var n=this;s(".user-media-image-thumbnail").each(function(e){var i=s(this).data("widget-url");var o=s(this);var r=o.parent();s(this).find(".delete-user-media-icon").off("click").click(function(){var t=i.substr(i.lastIndexOf("/")+1);var e='<button class="btn btn-green btn-sm" type="button" id="remove_upload_submit">'+window.__vg_translator.t("editor.imageUploads.remove")+"</button>";var a=function(e){s("#remove_upload_submit").on("click",function(){s.ajax({type:"POST",url:"/usermedialibrary/remove",dataType:"json",data:{media_id:t}}).done(function(e,t,a){s(".tooltip").tooltip("destroy");o.remove();n.decreaseMediaCount();var i;if(r.hasClass("left")){n.columnHeightLeft-=1;if(n.columnHeightRight-n.columnHeightLeft>1){i=r.siblings(".right").children().last();r.siblings(".right").children().last().remove();r.append(i);n.columnHeightLeft+=1;n.columnHeightRight-=1;m.apply(n)}}else if(r.hasClass("right")){n.columnHeightRight-=1;if(n.columnHeightLeft-n.columnHeightRight>1){i=r.siblings(".left").children().last();r.siblings(".left").children().last().remove();r.append(i);n.columnHeightRight+=1;n.columnHeightLeft-=1;m.apply(n)}}}).fail(function(e,t,a){});s(".modal, .modal-backdrop").remove();s("body").removeClass("modal-open").css("overflow","")})};create_simple_modal("modal-sm","confirm_remove_upload",window.__vg_translator.t("editor.imageUploads.confirmRemoval"),window.__vg_translator.t("editor.imageUploads.removeMsg"),e,a)})})};return e}(jQuery)}();
!function(){"use strict";function e(e,t){this.resultContainer=null,this.iconLoader=t,this.options={item:{dragOption:{revert:!1,helper:widgetMenuDragOptionFactory("helper"),start:widgetMenuDragOptionFactory("start"),appendTo:"#infographic_container",zIndex:9999,cursor:"move"},dropOption:{}}},this.appendCount=0,this.results=[],this.page=0,this.pageCount=0,this.keywords="",this.filter="",this.resultLimit=100,this.initialize(e)}function c(t,i){var n=l('<li class="icon-results-placeholder"></li>');i.resultContainer.append(n),VGLibrary.helpers.loadIcon(t.id).then(function(e){e&&(n.replaceWith(iconLoader.iconMenuTemplateFactory({id:t.id,category:t.category,t:t._tags,i:t.illustration,p:"default"===t.type||"business"===t.type?0:1,business:"business"===t.type?1:0},e)),i.appendCount++,i.appendCount==i.results.length&&reInitSideBar())})}function n(o){var s=0<o.resultContainer.closest(".vg-custom-icons").size()||0<o.resultContainer.closest(".pictograms_list").size(),a=["vg-icon-rectangle","vg-icon-rounded-rectangle","vg-icon-diamond-shape","vg-icon-circle","vg-icon-oval","vg-icon-semi-circle","venngage-1","venngage-2","venngage-3","vg-icon-triangle-right","vg-icon-triangle-down","vg-icon-triangle-left","vg-icon-triangle-up","vg-icon-half-circle-right","vg-icon-half-circle-down","vg-icon-half-circle-left","vg-icon-half-circle-up","vg-icon-quarter-curve","vg-icon-quarter-curve-dotted","vg-icon-quarter-curve-arrow","vg-icon-quarter-curve-arrow-dotted","vg-icon-quarter-curve-double-arrow","vg-icon-quarter-curve-double-arrow-dotted","vg-icon-half-curve","vg-icon-half-curve-dotted","vg-icon-half-curve-arrow","vg-icon-half-curve-arrow-dotted","vg-icon-half-curve-double-arrow","vg-icon-half-curve-double-arrow-dotted"];o.appendCount=0;var e=window.enable_business_icons?"":"NOT type:business";iconIndex.search(o.keywords,{hitsPerPage:40,facetFilters:["attr_style:"+o.filter],filters:e,restrictSearchableAttributes:__vg_iconSearchEnglishAttributes,page:o.page},function(e,t){var i=[],n=[];if(o.resultContainer.parent().find(".icon-search-show-more").remove(),t.hits=t.hits.filter(function(e){return"string"==typeof e.id&&0<e.id.length}),0==t.nbHits)return o.resultContainer.parent().find(".icon-filter-container").css("display","none"),void o.resultContainer.append(l('<li style="width: 100%; font-size: 13px; color: #555; padding: 0 5px;">'+window.__vg_translator.t("editor.icons.no_search_results")+" <strong>"+o.keywords.trim()+"</strong></li>"));s||"color"===o.filter||0!=o.page||(-1!==o.keywords.indexOf("arrow")||-1!==o.keywords.indexOf("direction")?generateArrowWidgets(o.resultContainer):-1!==o.keywords.indexOf("line")?generateLineWidgets(o.resultContainer):-1!==o.keywords.indexOf("border")&&generateBorderWidgets(o.resultContainer)),o.resultContainer.parent().find(".icon-filter-container").css("display","block"),o.results=t.hits,o.pageCount=t.nbPages,o.pageCount-1>o.page&&o.resultContainer.parent().children(".search-separate").before(l('<div class="icon-search-show-more">'+window.__vg_translator.t("editor.misc.showMore")+"</div>").click(function(){o.paginate()}));for(var r=0;r<o.results.length;r++)s&&(a.includes(o.results[r].id)||o.results[r].illustration)?(o.results.splice(r,1),r--):(o.results[r].illustration?n:i).push(o.results[r]);i.length||n.length?function e(t,i,n,r){r=r||0,i.length&&r%5==0||!t.length?(c(i[0],n),i.shift()):(c(t[0],n),t.shift()),(t.length||i.length)&&e(t,i,n,++r)}(i,n,o):o.paginate()})}var l;window.Viz=window.Viz||{},window.Viz.IconSearch=(l=jQuery,e.prototype.search=function(e,t){var i;e&&(i=l("<a />").addClass("clear-search-box").click(function(){var e;this.keywords="",l(e=this).closest(".general-search-container").find(".icon_search").val(""),l(e).closest(".general-search-container").find(".icon_search_result").empty(),l(e).closest(".general-search-container").find(".icon-search-show-more").remove(),l(e).closest(".general-search-container").find(".icon-filter-container").css("display","none"),l(e).closest(".general-search-container").find('.icon-filter-container input[type="radio"]:checked').prop("checked",!1),l(e).closest(".general-search-container").find('.icon-filter-container input[type="radio"][value=""]').prop("checked",!0),l(e).remove()}),this.page=0,this.keywords=e,this.filter=t,this.resultContainer.empty(),this.resultContainer.parent().find(".clear-search-box").remove(),this.resultContainer.parent().find(".search-input-box").append(i),n(this))},e.prototype.paginate=function(){this.pageCount-1>this.page&&(this.page++,n(this),VGEditor.track.mixpanel(("shape"==this.resultContainer.data("widget-category")?"Icon":"Icon Chart")+" Search",{pageNumber:this.page,query:this.keywords,filter:this.filter,infographic:page.identifier}))},e.prototype.initialize=function(e){this.options=l.extend(!0,this.options,e),null===this.options.container||"undefined"===this.options.container?this.resultContainer=l("<div></div>"):this.resultContainer=l("#"+this.options.container)},e.prototype.getResultContainer=function(){return this.resultContainer},e)}();
!function(){"use strict";window.VBrand=function(o){function r(t,e){this.settings={widgetType:"brand-media-image",classes:"brand-media-image-thumbnail widget-draggable ui-draggable ui-draggable-handle",dragOption:{disabled:false,revert:false,helper:"clone",appendTo:"body",zIndex:9999,cursor:"move",start:function(t,e){var n=o(e.helper).find("img");if(n.length>0){var i=n;e.helper.animate({width:i.width+10,height:i.height+50})}}}};this.logo=t;this.bucketUrl=e;this.$item=null;this.$tag=null}function t(t){this.settings=o.extend({},t);this.color=this.settings.color;this.$item=null}function e(t){if(typeof t.data.color&&typeof t.data.onColorChange==="function"){t.data.onColorChange(t.data.color)}}r.prototype.getUrl=function(){return this.bucketUrl&&this.logo?this.bucketUrl+"/"+this.logo:this.logo},r.prototype.getItem=function(){if(this.$item)return this.$item;var t=this.settings;var e=this.getUrl();this.$item=o("<div />");this.$item.attr({"data-widget-url":e||"#","data-widget-type":t.widgetType}).addClass(t.classes).draggable(t.dragOption).disableSelection().css({cursor:"pointer","background-size":"cover","background-repeat":"no-repeat","background-position":"center center","background-image":"url("+e+")"});return this.$item},t.prototype.getItem=function(){if(this.$item)return this.$item;this.$item=o("<div />");this.$item.addClass("input");var t=o("<div />").addClass("input-group-addon").css("background-color",this.color);this.$item.html(t);this.$item.on("click",this.settings,e);return this.$item};var i=null,a=null,n={url:"https://s3.amazonaws.com",bucketName:"brand-media"};function s(t){var e={logosContainer:"#brand_logos",bgContainer:"#editor_nav .backgroud-page-color",colorsContainer:".brand-swatch-container",textsContainer:"#brand_texts_container",textMenuClass:".brand-text-menu",url:"/brand/fetch",bucketPrivder:n};this.settings=o.extend(true,{},e,t);this.initialize()}function l(t){return o.ajax({type:"GET",url:t.url,cache:!0,async:!0,dataType:"json"}).done(function(t){var e,n;e=t,n={loaded:!0},["id","colors","logos","title","subtitle","text","name"].forEach(function(t){n[t]=void 0===e[t]?null:e[t]}),i=n}).fail(function(){i=null})}function d(t){return o.ajax({type:"GET",url:"/rest/customfonts?all=1&user_id="+t,cache:!0,async:!0,dataType:"json"}).done(function(t){"ok"===t.status&&(a=t.data)}).fail(function(){a=null})}function u(e){var n={loaded:!0};return["id","colors","logos","title","subtitle","text","name"].forEach(function(t){n[t]=void 0===e[t]?null:e[t]}),n}return s.prototype.initialize=function(){var t,e,n=this;this.ajaxFetch=(t=window.INFOGRAPHIC_USER_ID,o.ajax({type:"GET",url:"/rest/customfonts?all=1&user_id="+t,cache:!0,async:!0,dataType:"json"}).done(function(t){"ok"===t.status&&(a=t.data)}).fail(function(){a=null}).then(function(){Viz.eventBus.shout(a,"viz.customfonts.loaded",null)})),this.ajaxFetch=(e=this.settings,o.ajax({type:"GET",url:e.url,cache:!0,async:!0,dataType:"json"}).done(function(t){var e,n;e=t,n={loaded:!0},["id","colors","logos","title","subtitle","text","name"].forEach(function(t){n[t]=void 0===e[t]?null:e[t]}),i=n}).fail(function(){i=null}).then(function(){n.render(),Viz.eventBus.shout(i,"viz.brand.loaded",null)}))},s.prototype.getBucketUrl=function(){return this.settings.bucketPrivder.url+"/"+this.settings.bucketPrivder.bucketName},s.prototype.render=function(){this.renderLogosTo(this.settings.logosContainer),this.renderTexts(this.settings.textsContainer)},s.prototype.renderBrandKitButton=function(){var t="brand-kit-btn-"+(window.navigator.userLanguage||window.navigator.language),e=o("<a />").attr({href:"/brand"}).addClass("btn btn-green3 brand-kit-btn "+t).text(window.__vg_translator.t("editor.brandKit.add_to_brand"));return window.mixpanel.track_links(e,"Click on Add to Brand Kit",{location:"logo",businessAccess:businessAccess}),e},s.prototype.renderLogosTo=function(t){var e,n,i,a=o(t);0!=a.length&&(e=this.getBrandLogos(),n=this.getBucketUrl(),i=o('<div class="EmptyLogo" />').attr({id:"empty_logo"}).css({background:"#EBEBEB",width:"90px",height:"90px",margin:"3px",cursor:window.enable_brand_kit_regating?"pointer":"default"}),e&&0<e.length?e.forEach(function(t){a.append(o("<li />").html(new r(t,n).getItem()))}):window.enable_new_brand_kit_buttons?a.append(i):a.append(o("<li />").css({maxWidth:"100%",width:"100%",textAlign:"center"}).append(this.renderBrandKitButton())),reInitSideBar({}))},s.prototype.renderFreeLogosTo=function(t){var e=o(t);["/media/v2_img/brand/your_logo_blue.png","/media/v2_img/brand/your_logo_dark.png"].forEach(function(t){e.append(o("<li />").html(new r(t).getItem()))}),window.enable_new_brand_kit_buttons||e.append(o("<li />").css({maxWidth:"100%",width:"100%",textAlign:"center"}).append(this.renderBrandKitButton())),e.append('<li class="brand-kit-upgrade-message"><span><a href="/subscription/business" onClick="clickBrandKitUpgrade();">Upgrade to Business</a> to access this feature.</span></li>')},s.prototype.renderTexts=function(t){function n(t,e,n){e&&(t.data("brand",e),t.children().css({"font-family":e.fontFamily||"Roboto Condensed","font-weight":e.bold?"bold":"normal","font-style":e.italic?"italic":"normal","font-size":n||"20px","letter-spacing":"0.05em","text-decoration":e.underline?"underline":"none"}))}var i=this,e=o(t);0<t.length&&e.find(this.settings.textMenuClass).each(function(){var t=o(this);switch(t.data("brand-type")){case"title":n(t,i.getBrandTitle());break;case"subtitle":var e=i.getBrandSubtitle()&&-1!==["Aldrich","Archivo Black","Codystar","Graduate","Julius Sans One","Limelight","Monoton","Paytone One","Vast Shadow","Rye","Ultra","Coustard","Fredoka One","Fira Sans","Tajawal","Titillium Web","Baloo Thambi","Courgette","Fascinate Inline","Indie Flower","Kalam","Libre Baskerville","Libre Frankiln","PT Sans","PT Serif","Raleway Dots","Ribeye Marrow","Shrikhand","Quantico","Palanquin","Rubik Mono One"].indexOf(i.getBrandSubtitle().fontFamily)?"14px":"20px";n(t,i.getBrandSubtitle(),e);break;case"text":n(t,i.getBrandText())}})},s.prototype.getBrand=function(t){return i?t&&i.hasOwnProperty(t)?i[t]:null:i},s.prototype.getBrandColors=function(){var t=this.getBrand("colors");return t&&"string"==typeof t[0]?t.map(function(t){return{color:t,label:""}}):t},s.prototype.getBrandLogos=function(){return this.getBrand("logos")},s.prototype.getBrandTitle=function(){return this.getBrand("title")},s.prototype.getBrandSubtitle=function(){return this.getBrand("subtitle")},s.prototype.getBrandText=function(){return this.getBrand("text")},s}(jQuery)}();
var page,reInitSideBar,VGEditor=VGEditor||{},pageMask=function(){var e=$('<div class="modal hide" data-backdrop="static" data-keyboard="false"><div class="modal-header"><h1>Loading...</h1></div><div class="modal-body"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div></div>');return{show:function(){e.modal()},hide:function(){e.modal("hide")}}}(),getModifiedTime=function(e){return formatAMPM(e)},formatAMPM=function(e){var t=e.getHours(),i=e.getMinutes(),a=12<=t?"pm":"am";return(t=(t%=12)||12)+":"+(i=i<10?"0"+i:i)+a};!function(){"use strict";function e(e){this.settings=l.extend({},{iconClass:null,iconContainerClass:"vg-icon-container",enableLocalStorage:!1,url:"/resource/icon/metadata.json"},e),this.loading=!1,this.loadedAllCategory=!1,this.ajaxFetch=null,this.ajaxSearch=null,this.currentSearch="",this.searchCallback=null,this.lastSearchedCategory=null,this.pictogramsList=null,this.startLoad=0,this.loadCount=40,this.initialize(e),this.cacheCounter=5}function t(e){return l.ajax({type:"GET",url:e.settings.url,cache:!0,async:!0,dataType:"json"}).done(function(e){g=e}).fail(function(){g=null})}var l,c,i,g;window.VIconLoader=(l=jQuery,c=function(){var a=[],o=[];return{get:function(e){var t=a.indexOf(e);if(0<=t)return o[t]},set:function(e,t){var i=a.indexOf(e);i<0&&(i=a.length),a[i]=e,o[i]=t},has:function(e){return-1!==a.indexOf(e)},remove:function(e){var t=a.indexOf(e);0<=t&&(a.splice(t,1),o.splice(t,1))}}}(),i=function(){var t="vIconMeta";return Storage.prototype.setObj=function(e,t){return this.setItem(e,JSON.stringify(t))},Storage.prototype.getObj=function(e){return JSON.parse(this.getItem(e))},{load:function(){try{return console.log("load from icon meta storage"),localStorage.getObj(t)}catch(e){console.log(e)}return null},add:function(e){try{console.log("add icon meta into storage"),localStorage.setObj(t,e)}catch(e){console.log(e)}}}}(),g=null,e.prototype.initialize=function(){null==g&&("undefined"!=typeof Storage&&this.settings.enableLocalStorage&&(g=i.load())||(this.ajaxFetch=t(this)))},e.prototype.load=function(e){var t;return"function"==typeof e&&((t=this).ajaxFetch?t.ajaxFetch.always(function(){t.settings.enableLocalStorage&&g&&i.add(g),e.call(t)}):e.call(t)),this},e.prototype.getIconMetaData=function(e){return"object"==typeof g?g[e]:null},e.prototype.getAllMetaData=function(){return g},e.prototype.searchByCategoryName=function(e,t,i){var a=this;if(null!=g&&g.hasOwnProperty(e)){this.loadedAllCategory=!1,this.loading=!1;var o=0<t.closest(".pictograms_list").size();return this.currentSearch!=e||this.pictogramsList!=o?(this.currentSearch=e,this.startLoad=0,this.pictogramsList=o,t.css("overflow","hidden"),t.css("max-height",0),t.closest(".side-menu-container").scrollTop(t.closest("li").position().top+(this.pictogramsList?454:104)),this.loadIcons(t,e,i)):(this.currentSearch="","function"==typeof i&&i()),this}0<a.cacheCounter&&setTimeout(function(){a.cacheCounter--,a.searchByCategoryName(e,t,i)},1e3)},e.prototype.loadIcons=function(e,i,t){if(!this.loading&&!this.loadedAllCategory){this.loading=!0;var a=0,o=this,r=this.loadCount;this.pictogramsList||"Arrows & Directions"!=i||0!=o.startLoad||generateArrowWidgets(e);for(var n,s=function(){++a==r&&(i==o.currentSearch&&(o.loading=!1,o.renderTo(e,t),o.startLoad+=r),"function"==typeof t&&t())},d=this.startLoad;d<this.startLoad+r;d++)d>=g[i].length-1&&(this.loadedAllCategory=!0),g[i][d]&&c.has(g[i][d].id)&&(n=c.get(g[i][d].id),""==l(n).html()&&c.remove(g[i][d].id)),g[i][d]&&!c.has(g[i][d].id)?(this.pictogramsList&&(0<=["vg-icon-rectangle","vg-icon-rounded-rectangle","vg-icon-diamond-shape","vg-icon-circle","vg-icon-oval","vg-icon-semi-circle","vg-icon-triangle-right","vg-icon-triangle-down","vg-icon-triangle-left","vg-icon-triangle-up","vg-icon-half-circle-right","vg-icon-half-circle-down","vg-icon-half-circle-left","vg-icon-half-circle-up","vg-icon-quarter-curve","vg-icon-quarter-curve-dotted","vg-icon-quarter-curve-arrow","vg-icon-quarter-curve-arrow-dotted","vg-icon-quarter-curve-double-arrow","vg-icon-quarter-curve-double-arrow-dotted","vg-icon-half-curve","vg-icon-half-curve-dotted","vg-icon-half-curve-arrow","vg-icon-half-curve-arrow-dotted","vg-icon-half-curve-double-arrow","vg-icon-half-curve-double-arrow-dotted"].indexOf(g[this.currentSearch][d].id)||"1"==g[this.currentSearch][d].i)&&r++,function(){var t=g[i][d];VGLibrary.helpers.loadIcon(t.id).then(function(e){e&&!c.has(t.id)&&c.set(t.id,o.iconMenuTemplateFactory(t,e)),s()})}()):s()}},e.prototype.renderTo=function(e,t){e.show(),l(".load-more-icons").remove();for(var i,a=this,o=this.loadCount,r=this.startLoad;r<this.startLoad+o;r++)g[this.currentSearch][r]&&c.has(g[this.currentSearch][r].id)&&(this.pictogramsList&&(0<=["vg-icon-rectangle","vg-icon-rounded-rectangle","vg-icon-diamond-shape","vg-icon-circle","vg-icon-oval","vg-icon-semi-circle","vg-icon-triangle-right","vg-icon-triangle-down","vg-icon-triangle-left","vg-icon-triangle-up","vg-icon-half-circle-right","vg-icon-half-circle-down","vg-icon-half-circle-left","vg-icon-half-circle-up","vg-icon-quarter-curve","vg-icon-quarter-curve-dotted","vg-icon-quarter-curve-arrow","vg-icon-quarter-curve-arrow-dotted","vg-icon-quarter-curve-double-arrow","vg-icon-quarter-curve-double-arrow-dotted","vg-icon-half-curve","vg-icon-half-curve-dotted","vg-icon-half-curve-arrow","vg-icon-half-curve-arrow-dotted","vg-icon-half-curve-double-arrow","vg-icon-half-curve-double-arrow-dotted"].indexOf(g[this.currentSearch][r].id)||"1"==g[this.currentSearch][r].i)?o++:e.append(c.get(g[this.currentSearch][r].id)));this.loadedAllCategory||((i=l("<a>").text(window.__vg_translator.t("editor.misc.showMore"))).click(function(){l(this).children(".icon-container-refresh").remove(),l(this).empty().css({"max-width":"35px","border-radius":"40px"}).append(l('<span class="glyphicon glyphicon-refresh icon-container-refresh" />')),a.loadIcons(e,a.currentSearch)}),e.append(l("<li>").addClass("load-more-icons").append(i))),e.animate({"max-height":e[0].scrollHeight},300,"linear",function(){a.startLoad==a.loadCount&&e.closest(".side-menu-container").scrollTop(e.closest("li").position().top+(a.pictogramsList?454:104))}),reInitSideBar({})},e.prototype.iconMenuTemplateFactory=function(e,t){var i=!1;(1===e.p&&1===allowPremiumWidgets||1===e.business&&1===allowBusinessWidgets||0===e.p&&(0===e.business||void 0===e.business))&&(i=!0);var a,o=l("<li />"),r=i?"widget-draggable":"widget-non-draggable",n='<i class="'+e.id+'"></i>',s=l("<div />");return"1"==e.i&&o.addClass("illustration-container"),s.addClass(r).addClass("shapes-icons").attr("data-widget-illustration","1"==e.i).attr("data-widget-type",e.id),a=e,VGLibrary.icons[a.id]&&!VGLibrary.icons[a.id].old_icon&&(n=VGLibrary.icons[e.id].svg.replace("<svg",VGLibrary.icons[e.id].color||"1"==e.i?"<svg fill='#000'":"<svg fill='#555'"),s.addClass("icon8-api-icons")),t&&t.diverseGroupId&&(n+='<span class="diverse-icon-indicator"></span>'),"1"!=e.p&&1!=e.p||1===allowPremiumWidgets?1!==e.business&&"1"!==e.business||0!==allowBusinessWidgets||(n+='<span class="business-badge"><span>'+window.__vg_translator.t("editor.widgets.business_badge_default")+"</span></span>"):n+='<span class="premium-badge"><span>'+window.__vg_translator.t("editor.widgets.premium_badge_default")+"</span></span>",o.append(s.html(n))},e)}();var favouritesIcons=[];function initFavouritesIcons(){$("ul.favourites-icons").append($("<li />").addClass("li-break")),$("ul.favourites-icons li:not(.empty-favourites) div").each(function(e,i){var a=$(this).data("widget-type");favouritesIcons.push(a),VGLibrary.helpers.loadIcon(a).then(function(e){var t;e&&(t='<i class="'+a+'"></i>',VGLibrary.icons[a].old_icon||(t=VGLibrary.icons[a].svg.replace("<svg",VGLibrary.icons[a].illustration?"<svg fill='#000'":"<svg fill='#555'"),$(i).addClass("icon8-api-icons")),VGLibrary.icons[a].illustration&&($(i).parent().addClass("illustration-container"),$(i).attr("data-widget-illustration",!0),$("ul.favourites-icons").append($(i).parent())),t=VGLibrary.helpers.updateSvgDeps(t,e.illustration&&e.business),$(i).html(t))})})}function oldIconToSvg(e,t){if(e&&e.old_icon){var i=document.createElement("div"),a=new Raphael(i,t.width,t.height).path(e.svg).attr({fill:"#555",stroke:0}),o=a.getBBox(),r=Math.max(t.width-4,1),n=Math.max(t.height-4,1),s=.9*Math.min(r/o.width,n/o.height),d=(t.width-o.width)/2,l=(t.height-o.height)/2;return a.transform("t"+-1*o.x+","+-1*o.y+"t"+d+","+l+"s"+s+", "+s*e.orientation),i}return null}function adjustSVGViewBox(e,t){var i,a,o;return e.viewBox&&e.svg&&!isNaN(parseFloat(t))&&(i=e.viewBox.split(" "),a=t/Math.max(i[2],i[3]),(o=$(e.svg).attr({width:a*i[2],height:a*i[3]}))[0].setAttribute("viewBox",e.viewBox)),o}var iconHelperClass="shapes-icons-helper";function widgetMenuDragOptionFactory(e){function r(e){return(e||0)*(zoom_percent/100)}switch(e){case"helper":return function(){var e={width:r(80),height:r(80)},t=$(this).data("widget-type");if(/^(fa3-icon|rjs[1-2]-icon).*/.test(t)){var i=oldIconToSvg(VGLibrary.icons[t],e);if(i)return $("<div />").addClass(iconHelperClass).css(e).append(i).data("icon-type",t)}else if(/^icons8|venngage-/.test(t)||$(this).data("widget-illustration")){var a=/^venngage-/i.test(t)?120:/^icons8-/i.test(t)?80:280,o=adjustSVGViewBox(VGLibrary.icons[t],r(a));return o?(e.width=o.attr("width"),e.height=o.attr("height")):o=$(this).children().clone(),$("<div />").addClass(iconHelperClass).css(e).append(o.css(e)).data("icon-type",t)}return $(this).clone()};case"start":return function(e,t){var i=$(t.helper).hasClass("shapes-icons-helper")?t.helper.height()/2:t.helper.height(),a={left:Math.floor(t.helper.width()/2),top:i};$(this).draggable("instance").offset.click=a,$(t.helper).addClass("now-draggable")};default:return function(){}}}function generateArrowWidgets(e){e.append(["arrow-up","arrow-down","arrow-left","arrow-right"].map(function(e){return $("<li />").css({float:"left"}).append($("<div />",{class:"widget-draggable shapes-icons icon8-api-icons ui-draggable ui-draggable-handle","data-widget-type":"proper-"+e}).append($("<i />",{class:"vg-icon-"+e})))}))}function generateLineWidgets(e){e.append(["horizontal","vertical"].map(function(e){return $("<li />").css({float:"left"}).append($("<div />",{class:"widget-draggable shapes-icons icon8-api-icons ui-draggable-handle ui-draggable","data-widget-type":"proper-"+e}).append($("<i />",{class:"vg-icon-"+e+"-line"})))}))}function generateBorderWidgets(e){e.append(["square","rounded-square","triangle","circle","diamond"].map(function(e){return $("<li />").css({float:"left"}).append($("<div />",{class:"widget-draggable shapes-icons icon8-api-icons ui-draggable-handle ui-draggable","data-widget-type":"border-"+e}).append($("<i />",{class:"icon-border-"+("rounded-square"==e?"rounded":e)})))}))}function clickIconsUpgrade(e){var t="business"===e?"Business Icon":"Premium Icon";VGEditor.track.intercom("trackEvent","Click On Upgrade",{"Button ID":t,Feature:t+"s"}),window.save_upgrade_people_props({feature:t}),VGEditor.track.mixpanel("Click On Upgrade",{"Button ID":t,Feature:t+"s"}),sessionStorage.setItem("mixpanel_feature",JSON.stringify({data:{Feature:t+"s"}})),setTimeout(function(){window.location="premium"===e?"/account/subscription":"/account/subscription/business"},500)}function clickBrandKitUpgrade(){window.save_upgrade_people_props({feature:"Brand kit"}),VGEditor.track.mixpanel("Click on upgrade business link",{location:"logo message"}),VGEditor.track.intercom("trackEvent","Click on upgrade business link",{location:"logo message"}),sessionStorage.setItem("vg_upgrade_redirect",JSON.stringify({type:"redirect",data:{url:"/brand"}})),setTimeout(function(){window.location="/account/subscription/business"},500)}function clickEditorFileModalUpgrade(){window.save_upgrade_people_props({feature:"Save as Template"}),VGEditor.track.mixpanel("Click On Upgrade From Save As Template"),setTimeout(function(){window.location="/account/subscription/business"},500)}window.addEventListener("pageshow",function(e){e.persisted&&window.location.reload()}),$(document).ready(function(){var a,o,r,n,s=VGLibrary.utils.debounce(function(e){"undo"===e&&VGEditor.historyManagement.canUndo()?(page.deselectAll(),VGEditor.historyManagement.undo()):"redo"===e&&VGEditor.historyManagement.canRedo()&&(page.deselectAll(),VGEditor.historyManagement.redo())},200,!0),d=VGLibrary.utils.debounce(function(){var a=[],o=[],r=page.nextGroupId(),n={x:1e7,y:1e7},e=JSON.parse(localStorage.getItem("copiedWidgets"));if(!e||e.version!=APP_VERSION||e.widgets.length<1)return void localStorage.removeItem("copiedWidgets");if(e&&e.version==APP_VERSION&&1==e.widgets.length&&"viz.widget.standard.imagev2"===e.widgets[0].typeOf){var t=e.widgets[0];return void B(Viz.widget.create("viz.widget.standard.imageframe",{page:page.identifier,dimension:t.dimension,type:t.type,url:t.url,is_new:"true"}))}e.widgets.forEach(function(e){var t=Viz.widget.create(e.type||e.typeOf,{page:page.identifier,dimension:e.dimension,data:e.data,rotation:e.rotation||null});t.groupId=r,n.x=t.dimension.x<n.x?t.dimension.x:n.x,n.y=t.dimension.y<n.y?t.dimension.y:n.y,Viz.eventBus.shout(t,t.typeOf+".load",e.data),page.widget_map[t.identifier]=t,page.order.push(t.identifier),page.appendChild(t),a.push(t);var i={dimension:t.dimension,rotation:t.rotation,identifier:t.identifier,groupId:r,type:t.typeOf,data:t.data,page:t.page};o.push(i),VGEditor.addChartClickHandlers(t)}),page.deselectAll();var i=n.x-minimizeToZoom($(window).scrollLeft()),s=n.y-minimizeToZoom($(window).scrollTop());a.forEach(function(e){e.move(e.dimension.x-i,e.dimension.y-s),e.select(),page.selected.push(e.identifier)}),VGEditor.collaboration&&VGEditor.collaboration.isRTCEnabled()&&0<a.length&&(VGEditor.collaboration.syncWidgetFonts(a),VGEditor.collaboration.selectWidgets(a.map(function(e){return e.identifier})));groupOverlay.setPage(page),groupOverlay.show(),pageMask.show();var d=$(window).scrollTop();page.saveGroup(o,"add",function(e){pageMask.hide(),$(window).scrollTop(d),Viz.eventBus.shout(page,"viz.widget.page.change")}),window.loadFontsFrom(page),$(".ui-resizable-handle, .ui-rotatable-handle").css("opacity","0"),$(".group-overlay-box").css("border","none"),$.each(page.selected,function(e,t){var i=$(page.widget_map[t]).children().first()[0];$(i).addClass("paste-effect")}),setTimeout(function(){$(".ui-resizable-handle, .ui-rotatable-handle").css("opacity",""),$(".group-overlay-box").css("border",""),$(".paste-effect").removeClass("paste-effect")},600)},500,!0),k=!1,l={ARROW_UP:38,ARROW_LEFT:37,ARROW_DOWN:40,ARROW_RIGHT:39,BACKSPACE:8,DELETE:46,ESCAPE:27,ENTER:13,A:65,C:67,D:68,G:71,V:86,Y:89,Z:90};document.getElementById("LoadingScreen")||M(),e(),pageTitle=pageTitle||"New Infographic",mode=mode||"readonly",pageW=pageW||816,pageH=pageH||1056,page=Viz.widget.create("viz.widget.page",{identifier:pageId,title:pageTitle,pages_count:pagesCount,dimension:{width:pageW,height:pageH}}),"boolean"!=typeof isMultipageEditor||isMultipageEditor||$.ajax({cache:!1,type:"GET",url:restEndPoint.widgetUrl+page.identifier}).done(function(e){"Failed"===e.status&&window.location.reload()}),page.load(),page.setMode(mode),page.setSnap(pageGridSize),page.setSnapToGuide(!0),VGLibrary.quill.lastKnownFormat={},VGLibrary.quill.currentTextProps={},VGLibrary.quill.container=$("<div>"),VGLibrary.quill.container.css({color:"rgb(0,0,0)",display:"none"}),VGLibrary.quill.container.attr("id","quill_text_editor"),$("#infographic_container").after(VGLibrary.quill.container),VGLibrary.quill.instance=new Quill(VGLibrary.quill.container[0],{styles:!1}),VGLibrary.quill.instance.on("text-change",function(e,t){var i,a,o,r,n;"user"===t&&(VGLibrary.quill.fixUnderlineColor(),VGLibrary.quill.selection=VGLibrary.quill.instance.getSelection(),5e3<(i=VGLibrary.quill.instance.getLength())&&e.ops[1]&&e.ops[1].insert?VGLibrary.quill.instance.deleteText(4999,i):e.ops&&(e.ops[0]&&e.ops[0].delete||e.ops[1]&&e.ops[1].delete)?VGLibrary.quill.updateToolbarUI():e.ops&&(e.ops[0]&&/^[\t]+$/.test(e.ops[0].insert)||e.ops[1]&&/^[\t]+$/.test(e.ops[1].insert))?VGLibrary.quill.updateToolbarUI(!0):e.ops&&(e.ops[0]&&/^[\n\s]+$/.test(e.ops[0].insert)||e.ops[1]&&/^[\n\s]+$/.test(e.ops[1].insert))&&((a=VGLibrary.quill.selection.start-2)<0&&(a=0),(o=VGLibrary.quill.selection.start-1)<0&&(o=1),r=VGLibrary.quill.instance.getContents(a,o),n=VGLibrary.quill.instance.getContents(VGLibrary.quill.selection.start,VGLibrary.quill.selection.start+1),(r.ops&&r.ops[0]&&/^[\n\s]+$/.test(r.ops[0].insert)||n.ops&&n.ops[0]&&!/^[\n]+$/.test(n.ops[0].insert))&&VGLibrary.quill.updateToolbarUI(!0)),page.widget_map[VGLibrary.quill.currentTextWidgetID].resizeText())}),VGLibrary.quill.instance.on("selection-change",function(e){e&&(VGLibrary.quill.selection=e,VGLibrary.quill.updateToolbarUI())}),$(document).keydown(function(e){switch(1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 key down"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 key down"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw key down")),e.keyCode){case l.ARROW_UP:case l.ARROW_DOWN:case l.ARROW_LEFT:case l.ARROW_RIGHT:($(":focus:not(a)").length<1||"BODY"==$(":focus:not(a)").prop("tagName"))&&e.preventDefault()}i(e),c(e),p(e),h(e),f(e),w(e),V(e),E(e),z(e)}),$(document).keyup(function(e){t(e.keyCode)});var t=function(e){if(!(0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName"))&&0<page.selected.length){var i={x:0,y:0};switch(e){case l.ARROW_UP:i.y=-1;break;case l.ARROW_DOWN:i.y=1;break;case l.ARROW_LEFT:i.x=-1;break;case l.ARROW_RIGHT:i.x=1}if(0!=i.x||0!=i.y){if(VGEditor.setting.isInEditMode())return;page.selected.forEach(function(e){var t=page.widget_map[e];t&&t.classList.contains("ui-draggable")&&(t.dimension.x+=i.x,t.dimension.y+=i.y,t.move(t.dimension.x,t.dimension.y))});var t=$("#vGroupOverlay");"block"===t.css("display")&&(t.css("top","+="+i.y+"px"),t.css("left","+="+i.x+"px")),clearTimeout(o),r=page.selected,o=setTimeout(function(){page.groupMove(r)},500)}}};var i=function(e){if(!(0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName")||VGEditor.setting.isInEditMode())){var t=e.metaKey||e.ctrlKey,i=e.keyCode===l.C,a=e.keyCode===l.V;if(t&&i){if(VGEditor.smartWidget.isSelected())return;1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 keyboard copy"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 keyboard copy"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw keyboard copy")),function(e){var e=e.slice(),r=[];1<e.length&&e.sort(function(e,t){return page.order.indexOf(e)-page.order.indexOf(t)}),1===e.length?e.forEach(function(e){var t,i,a,o=page.widget_map[e];a="viz.widget.standard.imagev2"===o.typeOf?((t=o.data.settings.cropimage)&&(i=t.dimension.type,height="rectangle"===i?(width=t.dimension.widget_width,t.dimension.widget_height):(width=t.dimension.width,t.dimension.height),x=o.dimension.x+20,y=o.dimension.y+20),{typeOf:o.typeOf,data:o.data,rotation:o.rotation||null,page:page.identifier,dimension:{x:x,y:y,width:width,height:height},type:i,url:o.data.settings.general.url.value,is_new:"true"}):{typeOf:o.typeOf,dimension:o.dimension,data:o.data,rotation:o.rotation||null},r.push(a)}):e.forEach(function(e){var t=page.widget_map[e],i={typeOf:t.typeOf,dimension:t.dimension,data:t.data,rotation:t.rotation||null};r.push(i)});try{var t={version:APP_VERSION,widgets:r};localStorage.setItem("copiedWidgets",JSON.stringify(t))}catch(e){create_simple_modal("modal-sm","copied_error_modal",window.__vg_translator.t("editor.misc.error_copy_title"),window.__vg_translator.t("editor.misc.error_copy_body"),null,null,null),localStorage.setItem("copiedWidgets","")}}(page.selected)}else t&&a&&(1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 keyboard paste"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 keyboard paste"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw keyboard paste")),d())}},c=function(e){var t,i,a;0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName")||0<$(".page-loading").length||VGEditor.setting.isInEditMode()||(t=e.metaKey||e.ctrlKey,i=e.keyCode===l.Y,a=e.keyCode===l.Z,t&&i?(1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 keyboard redo"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 keyboard redo"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw keyboard redo")),e.preventDefault(),s("redo")):t&&a&&(1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 keyboard undo"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 keyboard undo"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw keyboard undo")),e.preventDefault(),s("undo")))};var g=VGLibrary.utils.debounce(function(){0<page.selected.length&&openWidgetMenuTool(page,"delete","Keyboard Shortcut")},500,!0),p=function(e){var t,i;VGEditor.smartWidget.isSelected()||0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName")||VGEditor.setting.isInEditMode()||(t=e.keyCode===l.DELETE,i=e.keyCode===l.BACKSPACE,(t||i)&&(1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 keyboard delete"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 keyboard delete"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw keyboard delete")),e.preventDefault(),g()))},u=VGLibrary.utils.debounce(function(){0<page.selected.length&&openWidgetMenuTool(page,"duplicate","Keyboard Shortcut")},100,!0),h=function(e){var t,i;VGEditor.smartWidget.isSelected()||VGEditor.setting.isInEditMode()||(t=e.metaKey||e.ctrlKey,i=e.keyCode===l.D,!0===t&&!0==i&&(1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 keyboard duplicate"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 keyboard duplicate"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw keyboard duplicate")),e.preventDefault(),u()))},v=VGLibrary.utils.debounce(function(){0<page.selected.length&&!0===VGEditor.setting.isInEditMode()&&VGEditor.setting.onSettingsPanelCancel()},500,!0),f=function(e){VGEditor.smartWidget.isSelected()||0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName")||!0==(e.keyCode===l.ESCAPE)&&v()},m=VGLibrary.utils.debounce(function(e){$(e).dblclick()},500,!0),w=function(e){var t;VGEditor.smartWidget.isSelected()||0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName")||!0!=(e.keyCode===l.ENTER)||1!==page.selected.length||(t=page.selected[0])&&page&&page.widget_map&&page.widget_map[t]&&(!1===VGEditor.setting.isInEditMode()&&m(page.widget_map[t]),e.preventDefault())},_=VGLibrary.utils.debounce(function(e){openWidgetMenuTool(page,"fwd","Keyboard Shortcut")},50,!0),b=VGLibrary.utils.debounce(function(e){openWidgetMenuTool(page,"bwd","Keyboard Shortcut")},50,!0),V=function(e){VGEditor.smartWidget.isSelected()||0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName")||VGEditor.setting.isInEditMode()||!0===(e.metaKey||e.ctrlKey)&&!0===e.altKey&&(e.keyCode===l.ARROW_UP&&(1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 keyboard fwd"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 keyboard fwd"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw keyboard fwd")),_(),e.preventDefault()),e.keyCode===l.ARROW_DOWN&&(1===page.selected.length&&page.activeWidget&&("viz.widget.standard.textv4"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 keyboard bwd"):"viz.widget.standard.textv5"===page.activeWidget.typeOf?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 keyboard bwd"):"viz.widget.reactWrapper"===page.activeWidget.typeOf&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("sw keyboard bwd")),b(),e.preventDefault()))},G=VGLibrary.utils.debounce(function(e){0<page.selected.length&&$("#toggle_group_widget").click()},200,!0),E=function(e){if(!VGEditor.smartWidget.isSelected()){for(var t=0;t<page.selected.length;t++)if("viz.widget.reactWrapper"===page.widget_map[page.selected[t]].typeOf)return;0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName")||VGEditor.setting.isInEditMode()||!0===(e.metaKey||e.ctrlKey)&&e.keyCode===l.G&&(G(),e.preventDefault())}},z=function(e){0<$(":focus:not(a)").length&&"BODY"!=$(":focus:not(a)").prop("tagName")||VGEditor.setting.isInEditMode()||!0===(e.metaKey||e.ctrlKey)&&e.keyCode===l.A&&e.preventDefault()};function C(e){var t={x:!1,y:!1},i={x:!1,y:!1};for(I in e){var a=e[I];(!1===t.x||a.x<t.x)&&(t.x=a.x),(!1===t.y||a.y<t.y)&&(t.y=a.y),(!1===i.x||a.x>i.x)&&(i.x=a.x),(!1===i.y||a.y>i.y)&&(i.y=a.y)}return{A:{x:t.x,y:t.y},B:{x:i.x,y:i.y}}}function L(e,t){var i,a,o=C(e),r=(C(t),Array());for(I in t){var n=t[I];a=o,(i=n).x>a.A.x&&i.x<a.B.x&&i.y>a.A.y&&i.y<a.B.y&&r.push(n)}if(4==r.length)return 1;for(var s=0;s<e.length;s++){var d=s+1;d>=e.length&&(d=0);for(var l={A:e[s],B:e[d]},c=0;c<t.length;c++){var g=c+1;g>=t.length&&(g=0);var p={A:t[c],B:t[g]};if(function(e,t,i,a,o,r,n,s){var d=((e*a-t*i)*(o-n)-(e-i)*(o*s-r*n))/((e-i)*(r-s)-(t-a)*(o-n)),l=((e*a-t*i)*(r-s)-(t-a)*(o*s-r*n))/((e-i)*(r-s)-(t-a)*(o-n));if(!isNaN(d)&&!isNaN(l)){if(i<=e){if(!(i<=d&&d<=e))return}else if(!(e<=d&&d<=i))return;if(a<=t){if(!(a<=l&&l<=t))return}else if(!(t<=l&&l<=a))return;if(n<=o){if(!(n<=d&&d<=o))return}else if(!(o<=d&&d<=n))return;if(s<=r){if(!(s<=l&&l<=r))return}else if(!(r<=l&&l<=s))return;return 1}}(l.A.x,l.A.y,l.B.x,l.B.y,p.A.x,p.A.y,p.B.x,p.B.y))return 1}}}$("#widget_container").append(page),$("#infographic_container").selectable({filter:".v-widget-selectable",cancel:".ignore-jqueryui-selectable",start:function(e,t){zoomComponent.state.open&&zoomComponent.handleClose(),window.alignmentComponent&&alignmentComponent.state.open&&alignmentComponent.handleClose(),closeOtherControlUI(),$(".youtube_widget_container").append($("<div>").addClass("youtube_overlap").css({position:"absolute","z-index":"10000",top:"0",bottom:"0",left:"0",right:"0"})),"enable_new_canvas"in window&&window.enable_new_canvas&&window.VGEditor&&window.VGEditor.widgetCanvas&&window.VGEditor.widgetCanvas.deselect&&"function"==typeof VGEditor.widgetCanvas.deselect&&window.VGEditor.widgetCanvas.deselect()},stop:function(e,t){var n,i,r,a,o,s,d,l;0!=$(".ui-selectable-helper").size()&&(n=[],(i=$(".ui-selectable-helper").offset()).width=$(".ui-selectable-helper").width(),i.height=$(".ui-selectable-helper").height(),n.push({x:i.left,y:i.top}),n.push({x:i.left+i.width,y:i.top}),n.push({x:i.left+i.width,y:i.top+i.height}),n.push({x:i.left,y:i.top+i.height}),n.width<10&&n.height<10||(r=[],$("#widget_container .v-widget-selectable").each(function(){var e,t,i,a,o;this.identifier&&(e=[],t=$("<div />").addClass("ui-resizable-handle ui-resizable-nw").appendTo(this),i=$("<div />").addClass("ui-resizable-handle ui-resizable-ne").appendTo(this),a=$("<div />").addClass("ui-resizable-handle ui-resizable-se").appendTo(this),o=$("<div />").addClass("ui-resizable-handle ui-resizable-sw").appendTo(this),e.push({x:Math.round(t.offset().left),y:Math.round(t.offset().top)}),e.push({x:Math.round(i.offset().left),y:Math.round(i.offset().top)}),e.push({x:Math.round(a.offset().left),y:Math.round(a.offset().top)}),e.push({x:Math.round(o.offset().left),y:Math.round(o.offset().top)}),t.remove(),i.remove(),a.remove(),o.remove(),L(n,e)&&r.push(this))}),page.dragSelect(r),groupOverlay.setPage(page),groupOverlay.show(),groupOverlay.notify(),$(".youtube_overlap").remove(),1!==page.selected.length||(a=page.widget_map[page.selected[0]]).typeOf&&"viz.widget.standard.textv5"===a.typeOf&&(o=window.pageXOffset,s=window.pageYOffset,"enable_richtext_widget"in window&&window.enable_richtext_widget||$("#draftEditor-"+a.identifier).find(".public-DraftEditor-content").focus().blur(),o===window.pageXOffset&&s===window.pageYOffset||window.scrollTo(o,s)),r.length||enableNewCanvas&&(d=document.getElementsByClassName("vg-canvas-event-wrapper-component"),l=[],Array.prototype.forEach.call(d,function(e){var t,i,a,o,r;e&&e.dataset&&e.dataset.key&&e.firstElementChild&&(t=e.dataset.key,i=[],o=e.firstElementChild,a={top:(r=o.getBoundingClientRect()).top+document.documentElement.scrollTop,left:r.left+document.documentElement.scrollLeft,width:r.width,height:r.height},i.push({x:a.left,y:a.top}),i.push({x:a.left+a.width,y:a.top}),i.push({x:a.left+a.width,y:a.top+a.height}),i.push({x:a.left,y:a.top+a.height}),L(n,i)&&l.push(t))}),l.length&&window.VGEditor&&window.VGEditor.widgetCanvas&&window.VGEditor.widgetCanvas.setMultiSelect&&"function"==typeof VGEditor.widgetCanvas.setMultiSelect&&VGEditor.widgetCanvas.setMultiSelect(l))))}});var O=$(".side-menu-container .icon-menu-container");function S(){if(void 0!==page.background){var e,t,i=page.background,a=i.gradient,o=i.background-o,r=i.currentStyle&&"gradient"===i.currentStyle;try{r&&a?(e=a.direction||0===a.direction?a.direction:90,t='"'+(a.type?a.type:"linear")+"-gradient("+e+"deg,"+a.colors+')"',$(page).css("background",t)):$("#infographic").css("background",i.background),o&&$("#infographic").css("background",o),void 0!==i.pattern&&$(page).css({"background-image":i.pattern})}catch(e){console.log("Editor Background styling error ",e)}}}O.click(function(e){e.preventDefault();var t,i=$(this),a=i.find(".category-name").data().categoryName,o=i.find("ul.dropdown-menu");a&&0==o.find("li").length?(t=$('<span class="glyphicon glyphicon-refresh icon-container-refresh" />'),i.find(".category-name").after(t),setTimeout(function(){var e=O.not(i);e.find("ul.dropdown-menu").html("").hide(),e.find(".btn-group").removeClass("open"),iconLoader.searchByCategoryName(a,o,function(){t.fadeOut(500,function(){this.parentNode.removeChild(this)})})},100)):($(e.target).hasClass("editor-2nd-level-menu")||0<$(e.target).parent(".editor-2nd-level-menu").size())&&o.toggle()}),$(".side-menu-container .line-icons-menu-container").click(function(e){e.preventDefault(),iconLoader.currentSearch="",$(".side-menu-container .line-icons-menu-container").not($(this)).find(".btn-group").removeClass("open"),O.find("ul.dropdown-menu").html("").hide(),O.find(".btn-group").removeClass("open")}),Viz.eventBus.listen("viz.widget.page.saved",function(e,t){}),Viz.eventBus.listen("viz.widget.drop_add_chart",function(e,t){var i=Viz.widget.create(e,{page:page.identifier,dimension:{x:t[0],y:t[1]},is_new:"true"});"viz.widget.standard.iconcolchartv2"===i.typeOf||"viz.widget.standard.iconbarchartv2"===i.typeOf?i.__iconLoadHandler&&"function"==typeof i.__iconLoadHandler.then?i.__iconLoadHandler.then(function(){B(i),VGEditor.addChartClickHandlers(i)}):console.error('Error: Promise not assigned to "widget.__iconLoadHandler" method'):(B(i),VGEditor.addChartClickHandlers(i))}),Viz.eventBus.listen("viz.widget.drop_add_map",function(e,t){B(Viz.widget.create(e,{page:page.identifier,dimension:{x:t[0],y:t[1]},is_new:"true"}))}),Viz.eventBus.listen("viz.widget.drop_add_pictogram",function(e,t){var i,a,o=t[1];switch(o){case"row":i=350,a=90;break;case"grid":i=350,a=190;break;default:i=480,a=300}B(Viz.widget.create("viz.widget.standard.pictov3",{page:page.identifier,icon:o?null:e,dimension:{x:t[0][0],y:t[0][1],width:i,height:a},is_new:"true",picto_type:o})),"row"!==o&&"grid"!==o||vgTooltipTrigger("icon_charts_guide")}),Viz.eventBus.listen("viz.widget.drop_add_shape",function(e,t){var i=t[1]||!1;if(t=t[0],"dotted-vertical"==e||"dotted-horizontal"==e){var a="horizontal";"dotted-horizontal"==e?(c=5,l=400):"dotted-vertical"==e&&(l=5,c=400,a="vertical");var o=Viz.widget.create("viz.widget.standard.dottedline",{page:page.identifier,dimension:{x:t[0],y:t[1],width:l,height:c},is_new:"true",orientation:a})}else if(["proper-horizontal","proper-vertical","proper-arrow-up","proper-arrow-down","proper-arrow-left","proper-arrow-right"].includes(e))var r="proper-arrow-up"==e||"proper-arrow-down"==e||"proper-vertical"==e,n=r?25:200,s=r?200:25,o=Viz.widget.create("viz.widget.standard.properline",{page:page.identifier,dimension:{x:t[0],y:t[1],width:n,height:s,vertical:r},is_new:"true",arrow_type_one:"proper-arrow-up"==e||"proper-arrow-left"==e?"type one":"None",arrow_type_two:"proper-arrow-down"==e||"proper-arrow-right"==e?"type one":"None"});else if(["border-square","border-rounded-square","border-triangle","border-circle","border-diamond"].includes(e)){var n=50,s=50,d="square";"border-circle"==e?d="circle":"border-rounded-square"==e?d="rounded":"border-triangle"==e?d="triangle":"border-diamond"==e&&(d="diamond",n=70,s=40);o=Viz.widget.create("viz.widget.standard.border",{page:page.identifier,dimension:{x:t[0],y:t[1],width:n,height:s,border_type:d},is_new:"true"})}else{var l=80,c=80;switch(e){case"vg-icon-horizontal-line":c=10,l=120;break;case"vg-icon-vertical-line":l=10,c=120;break;case"vg-icon-diamond-shape":case"vg-icon-oval":l=70,c=40;break;case"vg-icon-half-circle-right":case"vg-icon-half-circle-left":l=40,c=80;break;case"vg-icon-half-circle-down":case"vg-icon-half-circle-up":l=80,c=40;break;case"vg-icon-quarter-curve":case"vg-icon-quarter-curve-dotted":case"vg-icon-quarter-curve-arrow":case"vg-icon-quarter-curve-arrow-dotted":case"vg-icon-quarter-curve-double-arrow":case"vg-icon-quarter-curve-double-arrow-dotted":c=l=200;break;case"vg-icon-half-curve":case"vg-icon-half-curve-dotted":case"vg-icon-half-curve-arrow":case"vg-icon-half-curve-arrow-dotted":case"vg-icon-half-curve-double-arrow":case"vg-icon-half-curve-double-arrow-dotted":l=200,c=100;break;case"venngage-1":case"venngage-2":case"venngage-3":c=l=120;break;default:i&&(c=l=280)}o=Viz.widget.create("viz.widget.standard.shapev4",{page:page.identifier,icon:e,dimension:{x:t[0],y:t[1],width:l,height:c},is_new:"true"})}B(o),["vg-icon-half-curve-arrow","vg-icon-half-curve-arrow-dotted","vg-icon-half-curve-double-arrow","vg-icon-half-curve-double-arrow-dotted","vg-icon-quarter-curve-arrow","vg-icon-quarter-curve-arrow-dotted","vg-icon-quarter-curve-double-arrow","vg-icon-quarter-curve-double-arrow-dotted"].includes(e)&&Viz.eventBus.shout(o,"viz.widget.standard.shapev4.load",o.data);try{var g,p,u=JSON.parse(localStorage.getItem("diverseIconTooltip")),h=VGLibrary.icons[e],v=JSON.parse(localStorage.getItem("iconReplaceTooltips"))||{};0!==Object.keys(v).length&&null!==v.dblClickIcon&&0!==v.dblClickIcon||!(h&&!h.diverseGroupId||u)||(v.dblClickIcon=1,window.localStorage.setItem("iconReplaceTooltips",JSON.stringify(v))),v&&1===v.dblClickIcon&&((g=o.data.icon)&&(p=["vg-icon-rectangle","vg-icon-rounded-rectangle","vg-icon-circle","rjs1-icon-up-arrow","rjs1-icon-right-arrow","rjs1-icon-left-arrow","rjs1-icon-down-arrow"]),p.indexOf(g)<=-1&&(v.dblClickIcon=2,localStorage.setItem("iconReplaceTooltips",JSON.stringify(v)),Viz.eventBus.shout(o,"viz.widget.standard.shapev4.tooltip")))}catch(e){console.log(e)}}),Viz.eventBus.listen("viz.widget.drop_add_lines",function(e,t){var i,a,o,r,n;B(n="proper-horizontal"==e||"proper-vertical"==e?(i=!1,a=400,o=25,"proper-vertical"==e&&(i=!0,a=25,o=400),Viz.widget.create("viz.widget.standard.properline",{page:page.identifier,dimension:{x:t[0],y:t[1],width:a,height:o,vertical:i},is_new:"true"})):["vg-icon-quarter-curve","vg-icon-quarter-curve-dotted","vg-icon-quarter-curve-arrow","vg-icon-quarter-curve-arrow-dotted","vg-icon-quarter-curve-double-arrow","vg-icon-quarter-curve-double-arrow-dotted"].includes(e)?Viz.widget.create("viz.widget.standard.shapev4",{page:page.identifier,icon:e,dimension:{x:t[0],y:t[1],width:200,height:200},is_new:"true"}):["vg-icon-half-curve","vg-icon-half-curve-dotted","vg-icon-half-curve-arrow","vg-icon-half-curve-arrow-dotted","vg-icon-half-curve-double-arrow","vg-icon-half-curve-double-arrow-dotted"].includes(e)?Viz.widget.create("viz.widget.standard.shapev4",{page:page.identifier,icon:e,dimension:{x:t[0],y:t[1],width:200,height:100},is_new:"true"}):(w_width=50,w_height=50,r="square","border-circle"==e?r="circle":"border-rounded-square"==e?r="rounded":"border-triangle"==e?r="triangle":"border-diamond"==e&&(r="diamond",w_width=70,w_height=40),Viz.widget.create("viz.widget.standard.border",{page:page.identifier,dimension:{x:t[0],y:t[1],width:w_width,height:w_height,border_type:r},is_new:"true"}))),["vg-icon-half-curve-arrow","vg-icon-half-curve-arrow-dotted","vg-icon-half-curve-double-arrow","vg-icon-half-curve-double-arrow-dotted","vg-icon-quarter-curve-arrow","vg-icon-quarter-curve-arrow-dotted","vg-icon-quarter-curve-double-arrow","vg-icon-quarter-curve-double-arrow-dotted"].includes(e)&&Viz.eventBus.shout(n,"viz.widget.standard.shapev4.load",n.data)}),Viz.eventBus.listen("viz.widget.stickynote",function(e,t){B(Viz.widget.create(e,{page:page.identifier,dimension:{x:t[0][0],y:t[0][1]},color:t[1],is_new:"true"}))}),Viz.eventBus.listen("viz.widget.drop_add_integrations",function(e,t){B(Viz.widget.create(e,{page:page.identifier,dimension:{x:t[0],y:t[1]},is_new:"true"}))}),Viz.eventBus.listen("viz.widget.drop_add_circle_mask",function(e,t){B(Viz.widget.create(e,{page:page.identifier,dimension:{x:t[0]-150,y:t[1]-150,width:300,height:300},is_new:"true"}))}),Viz.eventBus.listen("viz.widget.drop_add_image_mask",function(e,t){B(Viz.widget.create(e,{page:page.identifier,dimension:{x:t[0][0]-150,y:t[0][1]-150,width:300,height:300},type:t[1],is_new:"true"}))}),Viz.eventBus.listen("viz.widget.drop_add_text",function(e,t){var i=Viz.widget.create(e,{page:page.identifier,dimension:{x:t[1][0],y:t[1][1]},is_new:"true",text_type:t[0],fontOptions:t[2]||null});B(i),"viz.widget.standard.textv5"===i.typeOf&&Viz.eventBus.shout(i,"viz.widget.standard.textv5.load",i.data)}),Viz.eventBus.listen("viz.widget.page.firstload",function(e,t){F(),$("#last_saved").html(getModifiedTime(new Date)),snapToGrid=!1}),Viz.eventBus.listen("viz.widget.page.loaded",function(e,t){var i;document.querySelector(".bleedMarks")&&!document.querySelector(".bleedOverlay")?"detectFF"in window&&detectFF()?setTimeout(function(){VGEditor.updatePrintBleed(!1)},500):VGEditor.updatePrintBleed(!1):page.getBleedMarks()&&page.updateBleedMarks(!1);try{var a=JSON.parse(localStorage.getItem("iconReplaceTooltips"));a&&1===a.dblClickIcon&&(a.dblClickIcon=0,localStorage.setItem("iconReplaceTooltips",JSON.stringify(a)))}catch(e){console.log(e)}if(document.getElementById("LoadingScreen")&&((i=document.getElementById("LoadingScreen")).classList.add("editor-fadeOut"),setTimeout(function(){if((i.parentNode.removeChild(i),"enable_smart_diagram_tours"in window&&window.enable_smart_diagram_tours)&&VGEditor.smartWidget.getFirstDiagramType())return;isEmailVerify&&1==tour_on&&0==document.getElementsByClassName("tourguide").length&&runTour()},2500)),""===$("#last_saved").val()&&("boolean"==typeof isMultipageEditor&&isMultipageEditor?$.ajax({method:"GET",url:"/rest/multipage/get_last_saved/"+pageId}).done(function(e){var t;200===e.code&&(t=new Date(e.last_saved.replace(/ /,"T")+"Z"),$("#last_saved").html(getModifiedTime(t)))}).fail(function(e){console.log("error: ",e)}):$.ajax({method:"GET",url:"/rest/infograph/get_last_saved/"+pageId}).done(function(e){var t;200===e.code&&(t=new Date(e.message.replace(/ /,"T")+"Z"),$("#last_saved").html(getModifiedTime(t)))}).fail(function(e){console.log("error: ",e)})),S(),generateGrid(),window.pageMarginDisplay&&VGEditor.togglePageMargins(),"boolean"==typeof isMultipageEditor&&isMultipageEditor&&document.getElementById("brandTemplateData"))try{var o=document.getElementById("brandTemplateData"),r=JSON.parse(o.innerHTML),n=JSON.parse(document.getElementById("pages").innerHTML),s=r.seed,d=r.palette,l=r.logo,c=pageId!==n[0];0===document.getElementsByClassName("page-loading").length&&1<n.length&&M(),void 0!==window.VGColorMapper&&window.VGColorMapper.colorRelocator(page,d,s),l&&void 0!==window.VGLogoMapper&&window.VGLogoMapper.generateLogo(page,l,!1,c),window.history&&window.history.replaceState&&window.history.replaceState("",document.title,window.location.pathname),pageId===n[n.length-1]&&o.parentNode.removeChild(o),1===n.length&&0!==document.getElementsByClassName("page-loading").length&&F()}catch(e){console.log("Editor brand generation error ",e)}else 0!==document.getElementsByClassName("page-loading").length&&F();VGEditor.historyManagement&&("boolean"==typeof isMultipageEditor&&isMultipageEditor&&VGEditor.historyManagement.resetHistory(),VGEditor.historyManagement.commit(VGEditor.getCurrentPageData()),VGEditor.historyManagement.publish("commit")),snapToGrid=!1,void 0!==window.localStorage&&(VGEditor.applyTooltipTriggers(),window.chartTourGuide&&function(e,t,i){if("function"==typeof e)return e(t,i);try{window.localStorage.setItem(t,i)}catch(e){console.error(e)}}(VGEditor.setLocalStorageItem,"enableEditChartTooltip","true")),window.setTimeout(function(){for(var e in page.widget_map)0<$(page.widget_map[e]).find("[data-highcharts-chart]").length&&page.widget_map[e].redrawFix()},200),enableIconConversion&&(enableIconConversion=!1,setTimeout(function(){VGEditor.autoConvertShapv4BoundingBox(page).then(function(e){e&&0<e.length&&page.saveGroup(e,"resize",null)})},500)),VGEditor.widgetCanvas.resizeCanvas({clearSelection:!0})}),Viz.eventBus.listen("viz.widget.page.reload",function(e,t){S(),F(!0)}),Viz.eventBus.listen("viz.widget.page.change",function(e,t){"viz.widget.page"!==e.typeOf&&"viz.widget.reactWrapper"!==e.typeOf&&!VGEditor.didWidgetChange(e)||(VGEditor.historyManagement&&VGEditor.historyManagement.commit(VGEditor.getCurrentPageData()),VGEditor.collaboration&&VGEditor.collaboration.syncHistory())}),Viz.eventBus.listen("viz.widget.page.error",function(e,t){page.setMode("readonly");create_simple_modal("modal-sm","logout_modal",window.__vg_translator.t("editor.misc.error"),window.__vg_translator.t("editor.misc.error_page"),null,function(e){$("#logout_modal .close-modal").on("click",function(){location.reload()})},null)}),Viz.eventBus.listen("viz.widget.self.duplicate",function(e,t){var i,a,o,r,n;e.data&&"viz.widget.standard.imagev2"===e.typeOf?(i=new Image,a=e.data.settings.general.url.value,(o=jQuery.extend(!0,{},e.dimension)).x+=20,o.y+=20,e.data.settings.cropimage.dimension.left=o.x,e.data.settings.cropimage.dimension.top=o.y,a&&/^\/(media\/)?image[-_]library\//.test(a)&&(a=a.replace(/^\/(media\/)?image[-_]library\//,"https://s3.amazonaws.com/"+imageSearchLibraryBucket+"/")),i.onload=function(){W(a,T,e.data.settings.cropimage)},i.src=a):e.data&&((o=jQuery.extend(!0,{},e.dimension)).x+=20,o.y+=20,r=jQuery.extend(!0,{},e.data),n=Viz.widget.create(e.typeOf,{page:page.identifier,dimension:o,data:r,rotation:e.rotation||null}),e.data&&"viz.widget.standard.imageframe"===e.typeOf?r.settings.image.imageFrameRect=null:e.data&&"viz.widget.standard.textv5"===e.typeOf&&(n.data=r),Viz.eventBus.shout(n,e.typeOf+".load",r),"viz.widget.standard.imageframe"===e.typeOf&&$(n).draggable("option","disabled")&&$(n).draggable("option",{disabled:!1}),B(n),["vg-icon-half-curve-arrow","vg-icon-half-curve-arrow-dotted","vg-icon-half-curve-double-arrow","vg-icon-half-curve-double-arrow-dotted","vg-icon-quarter-curve-arrow","vg-icon-quarter-curve-arrow-dotted","vg-icon-quarter-curve-double-arrow","vg-icon-quarter-curve-double-arrow-dotted"].includes(e.data.icon)&&Viz.eventBus.shout(n,"viz.widget.standard.shapev4.load",n.data),page.select(n),VGEditor.setting.close(),Viz.eventBus.shout(n,"viz.widget.self.settings.open"))}),Viz.eventBus.listen("viz.widget.self.delete.complete",function(e,t){page.widget_map.hasOwnProperty(e.identifier)&&("viz.widget.standard.textv4"===e.typeOf&&VGLibrary.quill.currentTextWidgetID===e.identifier&&VGLibrary.quill.hideEditor(),delete page.widget_map[e.identifier])}),Viz.eventBus.listen("viz.widget.page.groupDelete",function(t,e){Viz.eventBus.shout(t,"viz.widget.page.multiselect.delete"),pageMask.show(),t.groupDelete(function(e){Viz.eventBus.shout(t,"viz.widget.page.change"),pageMask.hide()})});var T={};$("#url_image_upload");function B(e){page.widget_map[e.identifier]=e,page.order.push(e.identifier),page.reorder(),e.data=VGEditor.patchImmutableOrder(e.data),"undefined"!=typeof isMultipage&&isMultipage?e.save(e.data,!0):(e.save(e.data,!1),page.save());var t,i="function"==typeof VGEditor.checkIfWidgetIsChart&&VGEditor.checkIfWidgetIsChart(e.typeOf)?"editPanel":null;Viz.eventBus.shout(e,"viz.widget.self.click",i),k&&(t=$(e).children().first()[0],$(".ui-resizable-handle, .ui-rotatable-handle").css("opacity","0"),$(t).addClass("paste-effect"),setTimeout(function(){$(".ui-resizable-handle, .ui-rotatable-handle").css("opacity",""),$(".paste-effect").removeClass("paste-effect")},600),setTimeout(function(){k=!1},1e3))}function A(e){uploadDimension={width:0,height:0,x:(e[0]||0)-25,y:(e[1]||0)-25};create_simple_modal("modal-sm","url_youtube_upload","Youtube URL","<div class='form'><div class='form-group'>\n                                    <label for='youtube_url' class='control-label' >Please enter the youtube URL</label>"+'<input type="text" class="form-control" name="youtube_url" id="youtube_url">\n                                  </div></div>','<input type="button" class="btn btn-green btn-sm" id="youtube_data_send" name="submit" value="Send" />',function(){function t(e){e.preventDefault();var t,i,a=$("#youtube_url").val();$("#url_youtube_upload").modal("hide"),uploadDimension.width=600,uploadDimension.height=355,uploadDimension.x-=uploadDimension.width/2,uploadDimension.y-=uploadDimension.height/2,t=a,i=uploadDimension,B(Viz.widget.create("viz.widget.standard.youtube",{page:page.identifier,data:{url:t},dimension:i})),$("body").removeClass("modal-open").css({overflow:"",cursor:""})}$("#youtube_data_send").on("click",t),$("#youtube_url").on("keyup",function(e){13==e.keyCode&&t(e)})}),$("#url_youtube_upload .close-modal").click(function(){k=!1})}var W=null;function e(e){$(".widget-non-draggable").on("click.preview",function(){var e="#"+$(this).closest("ul").attr("id"),t=($(this).parents(e).length?$(this).parents(e):$(this).parents(".dropdown-menu")).data("widget-category"),i=$(this).data("widget-type");if("image-mask"==t){var a='<a href="/account/subscription" class="btn btn-yellow btn-sm upgrade-to-premium" onclick="'+("mixpanel.track('Click On Upgrade', {'Button Number': '"+t+":"+i+"'}); Intercom('trackEvent', 'Click On Upgrade', {'Button Number': '"+t+":"+i+"'}); window.save_upgrade_people_props({ feature: 'Premium Image mask' });")+'">'+window.__vg_translator.t("editor.misc.upgrade_premium")+"</a>";create_simple_modal(null,"preview_modal",window.__vg_translator.t("editor.misc.frame_upgrade_header"),"<img style='max-width:100%' src='/media/v2_img/image-frame-preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.frame_upgrade_body")+"</div>",a,null,null)}else if("shape"==t||"pictogram"==t)$(this)[0].lastChild.classList[0]&&"premium-badge"===$(this)[0].lastChild.classList[0]?create_simple_modal(null,"upgrade_modal","<img src='/media/v2_img/premium-icons-modal-image.png' width='715px' />","<h2>"+window.__vg_translator.t("editor.icons.enhance")+"</h2><p>"+window.__vg_translator.t("editor.icons.illustration_upgrade")+"</p><button onClick='clickIconsUpgrade(\"premium\");' class='btn btn-lg btn-yellow3 upgrade-from-icons'>"+window.__vg_translator.t("editor.icons.upgrade")+"</button>","",null,null):$(this)[0].lastChild.classList[0]&&"business-badge"===$(this)[0].lastChild.classList[0]&&create_simple_modal(null,"upgrade_modal","<img src='/media/v2_img/premium-icons-modal-image.png' width='715px' />","<h2>"+window.__vg_translator.t("editor.icons.enhance")+"</h2><p>"+window.__vg_translator.t("editor.icons.illustration_business_upgrade")+"</p><button onClick='clickIconsUpgrade(\"business\");' class='btn btn-lg btn-yellow3 upgrade-from-icons'>"+window.__vg_translator.t("editor.icons.upgrade")+"</button>","",null,null);else{if("brand-kit"==t)return;var o="Premium "+(t[0].toUpperCase()+t.slice(1)+"s"),a='<a href="/account/subscription" class="btn btn-yellow btn-sm upgrade-to-premium" onclick="'+("                    mixpanel.track('Click On Upgrade', {                        'Button Number': '"+i+"',                        Feature: '"+o+"',                    });                    window.save_upgrade_people_props({ feature: '"+o+"' });                    Intercom('trackEvent', 'Click On Upgrade', {                        'Button Number': '"+i+"',                        Feature: '"+o+"',                    });                    sessionStorage.setItem(                        'mixpanel_feature',                        JSON.stringify({                            data: {                                Feature: '"+o+"',                            }                        })                    );                ")+'">'+window.__vg_translator.t("editor.misc.upgrade_premium")+"</a>";if(/viz.widget.standard.states./.test(i)){var r=Viz.widget.create(i,{dimension:{width:571,height:302}});create_simple_modal(null,"preview_modal",$(this).find("div").text()+window.__vg_translator.t("editor.charts.map_preview"),"<div class='upgrade-map-modal' style='height: 302px;'></div><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null),$(".upgrade-map-modal").append(r)}else switch(i){case"viz.widget.standard.canadamapv3":create_simple_modal(null,"preview_modal","Canada"+window.__vg_translator.t("editor.charts.map_preview"),"<img style='max-width:100%' src='/media/v2_img/canadamap_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.usmapv3":create_simple_modal(null,"preview_modal","United States"+window.__vg_translator.t("editor.charts.map_preview"),"<img style='max-width:100%' src='/media/v2_img/usamap_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.worldmapv3":create_simple_modal(null,"preview_modal","World"+window.__vg_translator.t("editor.charts.map_preview"),"<img style='max-width:100%' src='/media/v2_img/worldmap_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.asiamap":create_simple_modal(null,"preview_modal","Asia"+window.__vg_translator.t("editor.charts.map_preview"),"<img style='max-width:100%' src='/media/v2_img/asiamap_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.australiamap":create_simple_modal(null,"preview_modal","Australia"+window.__vg_translator.t("editor.charts.map_preview"),"<img style='max-width:100%' src='/media/v2_img/australiamap_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.africamap":create_simple_modal(null,"preview_modal","Africa"+window.__vg_translator.t("editor.charts.map_preview"),"<img style='max-width:100%' src='/media/v2_img/africamap_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.europemap":create_simple_modal(null,"preview_modal","Europe"+window.__vg_translator.t("editor.charts.map_preview"),"<img style='max-width:100%' src='/media/v2_img/europemap_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.ukmap":create_simple_modal(null,"preview_modal","United Kingdom"+window.__vg_translator.t("editor.charts.map_preview"),"<img style='max-width:100%' src='/media/v2_img/ukmap_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.map_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.3dcolumn":create_simple_modal(null,"preview_modal",window.__vg_translator.t("editor.charts.column_3d")+" "+window.__vg_translator.t("editor.misc.preview"),"<img style='max-width:100%' src='/media/v2_img/3d-column_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.chart_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.3dstackedcolumn":create_simple_modal(null,"preview_modal",window.__vg_translator.t("editor.charts.stacked_3d")+" "+window.__vg_translator.t("editor.misc.preview"),"<img style='max-width:100%' src='/media/v2_img/3d-stacked_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.chart_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.3dpie":create_simple_modal(null,"preview_modal",window.__vg_translator.t("editor.charts.pie_3d")+" "+window.__vg_translator.t("editor.misc.preview"),"<img style='max-width:100%' src='/media/v2_img/3d-pie_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.chart_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.pyramid":create_simple_modal(null,"preview_modal",window.__vg_translator.t("editor.charts.pyramid")+" "+window.__vg_translator.t("editor.misc.preview"),"<img style='max-width:100%' src='/media/v2_img/pyramid_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.chart_upgrade_body")+"</div>",a,null,null);break;case"viz.widget.standard.funnel":create_simple_modal(null,"preview_modal",window.__vg_translator.t("editor.charts.funnel")+" "+window.__vg_translator.t("editor.misc.preview"),"<img style='max-width:100%' src='/media/v2_img/funnel_preview.png'><div style='text-align:center'>"+window.__vg_translator.t("editor.misc.chart_upgrade_body")+"</div>",a,null,null)}}$("#upgrade_modal").click(function(e){$(e.target).hasClass("venngage-modal")&&$("#upgrade_modal .close-modal").click()})});var t=$.extend({},{dragTarget:"#editor_nav .widget-draggable",appendTarget:"#infographic_container",droppableContainer:"#widget_container"},e);$(t.dragTarget).draggable({revert:!1,appendTo:t.appendTarget,zIndex:9999,cursor:"move",helper:widgetMenuDragOptionFactory("helper"),start:widgetMenuDragOptionFactory("start"),stop:function(e,t){}}).disableSelection(),$(t.droppableContainer).droppable({accept:t.dragTarget,tolerance:"intersect",over:function(e,t){var i,a,o=$(t.helper);o.hasClass(iconHelperClass)?(i=o.data("icon-type"),a={fill:"#2d95ec"},/^(fa3-icon|rjs[1-2]-icon).*/.test(i)?o.find("path:first").attr(a):/^icons8|venngage-/.test(i)&&o.find("svg:first").attr(a)):o.addClass("hover-droppable")},out:function(e,t){var i,a,o=$(t.helper);o.hasClass(iconHelperClass)?(i=o.data("icon-type"),a={fill:"#555"},/^(fa3-icon|rjs2-icon).*/.test(i)?o.find("path:first").attr(a):/^icons8|venngage-/.test(i)&&o.find("svg:first").attr(a)):o.removeClass("hover-droppable")},drop:function(t,e){var i=$(this),a=e.draggable;q(0,a,function(){var e=i.offset();return[parseInt(minimizeToZoom(t.pageX-e.left)),parseInt(minimizeToZoom(t.pageY-e.top))]})}}),$(t.dragTarget).off("click").click(function(e){if(!k){if(e.target&&($(e.target).hasClass("delete-user-media-icon")||$(e.target).parent().hasClass("delete-user-media-icon")))return;var t=$("#widget_container"),i=$(this);k=!0,q(0,i,function(){return[Math.round(minimizeToZoom($(document).scrollLeft())+document.body.clientWidth/2-t.offset().left),Math.round(minimizeToZoom($(document).scrollTop())+document.body.clientHeight/2-t.offset().top)]})}}),$("#show-comments").off("change").change(function(e){var t=e.target.checked,i=Object.keys(page.widget_map).filter(function(e){return"viz.widget.standard.stickynote"===page.widget_map[e].typeOf}).map(function(e){return page.widget_map[e]});t?i.forEach(function(e){e.show()}):i.forEach(function(e){e.hide()})})}function q(e,t,i){var a,o,r,n,s,d=t.data("widget-type"),l=t.closest("ul").data("widget-category");if(!(/^(photo|upload)/.test(l)&&0<window.imageOverFrames)){switch($("#editor_nav input, #editor_nav button").blur(),l){case"chart":-1<["Bar","BigNumberDonut","ProgressBar","BigNumberHalfDonut","Column","GroupedColumn"].indexOf(d)?(a=-1<["Bar","Column","GroupedBar","GroupedColumn"].indexOf(d),h=i(),o={chartType:d,position:{x:parseFloat(h[0])-(a?300:100),y:parseFloat(h[1])-(a?175:75)},pageId:VGEditor.getActivePage().identifier},VGEditor.smartWidget.create("Chart",o,!0,VGEditor.smartWidget.chart.postCreation),setTimeout(function(){k=!1},1e3)):"viz.widget.standard.pictov3"===d?Viz.eventBus.shout(d,"viz.widget.drop_add_pictogram",[i(),t.data("picto-type")]):Viz.eventBus.shout(d,"viz.widget.drop_add_chart",i());break;case"icon_chart":case"pictogram":Viz.eventBus.shout(d,"viz.widget.drop_add_pictogram",[i(),t.data("picto-type")]);break;case"shape":Viz.eventBus.shout(d,"viz.widget.drop_add_shape",[i(),t.data("widget-illustration")]);break;case"map_res":case"map":Viz.eventBus.shout(d,"viz.widget.drop_add_map",i());break;case"text":"viz.widget.standard.textv4"===d?"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v4 create"):"viz.widget.standard.textv5"===d&&"function"==typeof VGEditor.timeAction&&VGEditor.timeAction("v5 create");var c=t.data("text-type"),g={fontFamily:"Roboto Condensed",fontSize:"30",textAlign:"left",bold:!1,italic:!1,underline:!1},p=t.data("brand")||{};switch(c){case"title":p.fontFamily||(g.fontFamily="Roboto",g.bold=!0),p=$.extend({},g,{fontSize:"50"},p),VGEditor.addToTopRecentFonts(p.fontFamily);break;case"subtitle":p=$.extend({},g,{fontSize:"30"},p),VGEditor.addToTopRecentFonts(p.fontFamily);break;case"text":p=$.extend({},g,{fontSize:"20"},p),VGEditor.addToTopRecentFonts(p.fontFamily)}Viz.eventBus.shout(d,"viz.widget.drop_add_text",[t.data("text-type"),i(),p]);break;case"lines":Viz.eventBus.shout(d,"viz.widget.drop_add_lines",i());break;case"photo":case"upload":var u={url:t.data("widget-url")};!function(e,t,o){switch(T={width:0,height:0,x:(t[0]||0)-25,y:(t[1]||0)-25},e){case"viz.widget.standard.masking.circle.v1":T.width=300,T.height=300,B(Viz.widget.create("viz.widget.standard.masking.circle.v1",{page:page.identifier,dimension:T}));break;case"viz.widget.standard.masking.v1":T.width=300,T.height=300,B(Viz.widget.create("viz.widget.standard.masking.v1",{page:page.identifier,dimension:T}));break;case"url-image":create_simple_modal("modal-sm","url_image_upload","Import an Image","<div class='form'><div class='form-group'><label for='image_url' class='control-label' >Please enter the image URL</label>"+'<input type="text" class="form-control" name="image_url" id="image_url"></div></div>','<input type="button" class="btn btn-green btn-sm" name="submit" value="Load Image" />',function(){$("#url_image_upload input[name='submit']").on("click",function(e){var t;e.preventDefault(),t="https://"!==$("#image_url").val().substring(0,7)&&"http://"===$("#image_url").val().substring(0,7)?"https://"+$("#image_url").val().substring(7):$("#image_url").val(),W(t,T),$("#url_image_upload").modal("hide"),$("body").removeClass("modal-open").css("overflow","")})});break;case"brand-media-image":if(VGEditor.track.mixpanel("Click on logo"),window.enable_brand_kit_regating)break;o.url&&((r=new Image).onload=function(){var e,t=150/Math.max(r.height,r.width),i=r.height*t,a=r.width*t;a>pageW&&(e=i/a,i=(a=pageW)*e),T.x-=a/2,T.y-=i/2,T.width=a,T.height=i,W(o.url,T)},r.src=o.url);break;case"user-media-image":var r;o.url&&((r=new Image).onload=function(){var e,t=r.height||600,i=r.width||600;for(i>pageW&&(e=t/i,t=(i=pageW)*e);300<i&&300<t;)i*=.7,t*=.7;T.x-=i/2,T.y-=t/4,T.width=i,T.height=t,W(o.url,T)},r.src=o.url);break;case"search-photo":o.url&&(pageMask.show(),$.ajax({url:"/infographics/cache_image/"+page.identifier,type:"POST",data:"image_url="+encodeURIComponent(o.url),processData:!1}).done(function(o){o.url&&setTimeout(function(){var a=new Image;a.onload=function(){var e,t=a.height||600,i=a.width||600;for(i>pageW&&(e=t/i,t=(i=pageW)*e);300<i&&300<t;)i*=.7,t*=.7;T.x-=i/2,T.y-=t/4,T.width=i,T.height=t,W("/image-library/"+o.url,T)},a.src="https://s3.amazonaws.com/"+imageSearchLibraryBucket+"/"+o.url},o.delay)}).fail(function(e){console.log("error: ",e)}).always(function(){pageMask.hide()}))}}(d,i(),u);break;case"image-mask":var h=i(),v=300,f=300;"ellipse"!==d&&"rectangle"!==d||(v=350,f=250),B(Viz.widget.create("viz.widget.standard.imageframe",{page:page.identifier,dimension:{x:h[0]-150,y:h[1]-150,width:v,height:f},type:d,is_new:!0}));break;case"integrations":"viz.widget.standard.youtube"===d?A(i()):"viz.widget.standard.stickynote"===d?(n="yellow",-1!==(r=t[0].id).indexOf("pink")?n="pink":-1!==r.indexOf("blue")?n="blue":-1!==r.indexOf("orange")?n="orange":-1!==r.indexOf("purple")?n="purple":-1!==r.indexOf("green")&&(n="green"),(s=document.getElementById("show-comments")).checked||(s.checked=!0,s.dispatchEvent(new Event("change"))),Viz.eventBus.shout(d,"viz.widget.stickynote",[i(),n])):Viz.eventBus.shout(d,"viz.widget.drop_add_integrations",i());break;case"group-widget":var m=t.data("group-widget-id");w=m,_=i(),w&&(pageMask.show(),$.ajax({url:restEndPoint.groupWidgetUrl+w,type:"GET"}).done(function(e){if(200===e.code){var l,t=JSON.parse(e.payload),c=t.length,g=[];e:if(1===c){var i=JSON.parse(t[0]);if("viz.widget.reactWrapper"!==i.typeOf||!i.data instanceof Object||!Array.isArray(i.data.content)||!i.data.content[0]instanceof Object||"smart"!==i.data.content[0].type)break e;var a=i.data.content[0];return a.position.x=_[0]-50,a.position.y=_[1]-50,VGEditor.createSingleNode(a),void pageMask.hide()}k=(0<c?(l=page.nextGroupId(),$.each(t,function(e,t){var i=JSON.parse(t),a=jQuery.extend(!0,{},i.data),o=jQuery.extend(!0,i.dimension,{x:i.dimension.x+_[0]-50,y:i.dimension.y+_[1]-50}),r=Viz.widget.create(i.type||i.typeOf,{page:page.identifier,dimension:o,data:a,rotation:i.rotation||null});r.groupId=l,Viz.eventBus.shout(r,r.typeOf+".load",a),page.widget_map[r.identifier]=r,page.order.push(r.identifier),page.appendChild(r);var n,s,d={dimension:r.dimension,rotation:r.rotation,identifier:r.identifier,groupId:l,type:r.typeOf,data:r.data,page:r.page};g.push(d),e==c-1&&(page.deselectAll(),n=[],$.each(g,function(e,t){var i=page.widget_map[t.identifier];i.select(),page.selected.push(t.identifier),VGEditor.collaboration&&VGEditor.collaboration.isRTCEnabled()&&n.push(i)}),groupOverlay.setPage(page),groupOverlay.show(),page.saveGroup(g,"add",function(e){Viz.eventBus.shout(page,"viz.widget.page.change"),pageMask.hide()}),VGEditor.collaboration&&VGEditor.collaboration.isRTCEnabled()&&0<n.length&&(VGEditor.collaboration.syncWidgetFonts(n),VGEditor.collaboration.selectWidgets(n.map(function(e){return e.identifier})))),k&&(s=$(r).children().first()[0],$(".ui-resizable-handle, .ui-rotatable-handle").css("opacity","0"),$(s).addClass("paste-effect"),setTimeout(function(){$(".ui-resizable-handle, .ui-rotatable-handle").css("opacity",""),$(".paste-effect").removeClass("paste-effect")},600))}),page.reorder(),window.loadFontsFrom(page)):pageMask.hide(),!1)}else pageMask.hide()}).fail(function(){pageMask.hide(),k=!1}))}var w,_,y={type:d,category:l,infographic:page.identifier};switch(l){case"shape":var b=VGLibrary.icons[d],V=!!b&&!!b.diverseGroupId;V&&(y.skin_tone=d.slice(-1)),y.diversity=V;case"icon_chart":case"pictogram":t.closest("ul")[0].classList.contains("icon_search_result")&&(y.query=t.closest(".general-search-container").find(".icon_search").val(),y.filter=t.closest(".general-search-container").find('.icon-filter-list input[type="radio"]:checked').val(),y.position=""+t.parent().index());break;case"photo":t.data("widget-url").includes("pixabay")?y.provider="pixabay":t.data("widget-url").includes("unsplash")?y.provider="unsplash":t.data("widget-url").includes("pexels")&&(y.provider="pexels");case"upload":y.file=t.data("widget-url");break;case"chart":switch(d){case"viz.widget.standard.pictov3":y.type=t.data("picto-type"),y.category="icon_chart";break;case"ProgressBar":y.type="BigNumberProgressBar";case"Bar":case"BigNumberDonut":case"BigNumberHalfDonut":case"Column":case"GroupedBar":case"GroupedColumn":y.category="smart-chart"}break;case"group-widget":var x="3af672b2-dbd6-457b-8196-90378d58ede1"===(m=t.data("group-widget-id"))||"6f72205e-2e71-45b1-b253-13e8834f7f01"===m||"80cfd0fc-d651-4092-95e8-3f82a80dec26"===m||"b992fc8a-3fbb-4a76-96d7-75df25d4bc98"===m||"824c272f-5b5e-456d-97ef-9ce35bea889c"===m||"da9942fe-2926-4af7-804a-16bb0dbbd13a"===m;"320426bf-4fbd-4803-ba3b-aa1b61bafd1f"===m||"4042b316-9274-4a15-8125-90a6408ed27d"===m||"ba62d9c2-09e9-49a3-a286-2b8386cce49e"===m?y.type="BigNumberChart":x&&(y.type="Chart")}VGEditor.track.mixpanel("Create Widget",y),VGEditor.track.intercom("trackEvent","Create Widget",y)}}function M(){n=$(window).scrollTop(),$("#infographic").hide();var e=$("<div>").addClass("page-loading"),t=$("#infographic_container").prepend(e).offset().left,i=($(window).width()-t)/2+window.pageXOffset;e.css({top:window.pageYOffset+250,left:i}),a=new Spinner({lines:15,length:20,width:4,radius:10,corners:1,rotate:0,color:"#808080",speed:1,trail:0,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:50,left:50}).spin(),$(a.el).css({top:"50px",left:"50px"}),e.html(a.el),groupOverlay.hide()}function F(e){e=e||!1,a&&a.stop(),$(".page-loading").remove(),$("#infographic").fadeIn(),e&&$(window).scrollTop(n)}W=function(e,t,i){var a,o,r,n,s=i?(r="Rectangle"===i.type?(a="rectangle",o=i.dimension.widget_width,i.dimension.widget_height):(a=i.type.toLowerCase(),o=i.dimension.width,i.dimension.height),n=i.dimension.left,i.dimension.top):(a="rectangle",o=t.width,r=t.height,n=t.x,t.y),d=Viz.widget.create("viz.widget.standard.imageframe",{page:page.identifier,dimension:{x:n,y:s,width:o,height:r},type:a,url:e,is_new:"true"});B(d);try{var l=JSON.parse(localStorage.getItem("photoReplaceTooltips"))||{};0!==Object.keys(l).length&&null!==l.dblClickIcon&&0!==l.dblClickIcon||(l.dblClickIcon=1,window.localStorage.setItem("photoReplaceTooltips",JSON.stringify(l))),l&&1===l.dblClickIcon&&(l.dblClickIcon=2,localStorage.setItem("photoReplaceTooltips",JSON.stringify(l)),Viz.eventBus.shout(d,"viz.widget.standard.imageframe.tooltip"))}catch(e){console.log(e)}},VGLibrary.quill.focusEditor=function(){$(".ql-editor").attr("data-gramm","false"),$(".ql-editor").focus().css({top:VGLibrary.quill.container.css("top"),left:VGLibrary.quill.container.css("left")}),$(".ql-editor").unbind("keyup.esc"),$(".ql-editor").on("keyup.esc",function(e){var t;27==e.keyCode&&((t=$.extend(!0,{},page.activeWidget.data)).settings.general.text.value=VGLibrary.quill.instance.getHTML(),Viz.eventBus.shout(page.activeWidget,page.activeWidget.typeOf+".load",t),page.activeWidget.save(page.activeWidget.data))}),this.instance.setSelection(this.instance.getLength(),this.instance.getLength())},$(".ql-editor").wrap("<div id='quill-draggable-el'></div>"),VGLibrary.quill.focusSelection=function(){this.selection&&this.instance.setSelection(this.selection.start,this.selection.end)},VGLibrary.quill.selectAll=function(e){e||this.instance.setSelection(0,this.instance.getLength())},VGLibrary.quill.updateToolbarUI=function(e){var t,i=this.selection?this.selection.start:0,a=this.selection?this.selection.end:0,o=this.instance.getContents(i,a),r=this.instance.getContents(0,1);r.ops&&r.ops[0]&&r.ops[0].attributes&&(this.lastKnownFormat=$.extend({},r.ops[0].attributes)),"none"===this.container.css("display")?(i=0,a=this.instance.getLength()-1,o=this.instance.getContents(i,a)):i===a&&(0===i?(o=this.instance.getContents(0,1),r.ops&&r.ops[0]&&/^[\n\s]+$/.test(r.ops[0].insert)&&(o.ops=[],o.ops.push({attributes:$.extend({},this.lastKnownFormat)}),JSON.stringify(r.ops[0].attributes)!=JSON.stringify(this.lastKnownFormat)&&this.prepareStylesForNewLine(o))):(o=this.instance.getContents(i-1,i)).ops[0]&&!o.ops[0].attributes&&o.ops[0].insert&&/^[\n\s]+$/.test(o.ops[0].insert)&&((t=this.instance.getContents(i,i+1)).ops[0]&&t.ops[0].attributes?(o.ops[0].attributes=$.extend({},t.ops[0].attributes),!0!==e&&!/^[\t]+$/.test(o.ops[0].insert)||this.prepareStylesForNewLine(o)):o.ops[0].attributes=this.findStylesForNewLine(i)));var n=this.checkAllForStyle(o.ops,"bold",!1),s=this.checkAllForStyle(o.ops,"italic",!1),d=this.checkAllForStyle(o.ops,"underline",!1),l=this.checkAllForStyle(o.ops,"color","rgb(0,0,0)")||"rgb(0,0,0)",c=this.checkAllForStyle(o.ops,"font","Oxygen"),g=!1===c?"Oxygen":c.replace(/[\'\"]/g,""),p=this.checkAllForStyle(o.ops,"link",!1)||"",u=""!==p,h=this.getAllFonts(o.ops);this.currentTextProps={isBold:n,isItalic:s,isUnderline:d,color:l,isFont:c,font:g,url:p,isUrl:u,allFonts:h,isList:0<$(VGLibrary.quill.instance.root).find("ol").length,isBullet:0<$(VGLibrary.quill.instance.root).find("ul").length},this.disableToolbarSelection(),VGEditor.setting.updateQuill(this.currentTextProps)},VGLibrary.quill.findStylesForNewLine=function(e){for(var t,i=0;i<20&&-1<e-1-i;){if(!(t=this.instance.getContents(e-1-i,e-i)).ops[0]||t.ops[0].attributes||!t.ops[0].insert||!/^[\n\s]+$/.test(t.ops[0].insert))return this.prepareStylesForNewLine(t),$.extend({},t.ops[0].attributes);i++}var a=this.instance.getContents(0,1);return a.ops=[],a.ops.push({attributes:$.extend({},this.lastKnownFormat)}),this.prepareStylesForNewLine(a),$.extend({},a.ops[0].attributes)},VGLibrary.quill.getCharacterStyles=function(e){for(var t={},i=Array.prototype.slice.call(VGLibrary.quill.instance.root.children),a=[],o=0;o<i.length;o++)if("OL"===i[o].nodeName||"UL"===i[o].nodeName)for(var r=Array.prototype.slice.call(i[o].children),n=0;n<r.length;n++)a.push(r[n]);else a.push(i[o]);for(var s,d=0;d<this.instance.getLength()-1;d++){var l=this.instance.getContents(d,d+1),c=this.checkAllForStyle(l.ops,"font","Oxygen"),g=this.checkAllForStyle(l.ops,"link",!1)||"",p=-1;for(var o in e)if(d>=e[o][0]&&d<e[o][1]){p=o;break}t[d]={isBold:this.checkAllForStyle(l.ops,"bold",!1),isItalic:this.checkAllForStyle(l.ops,"italic",!1),isUnderline:this.checkAllForStyle(l.ops,"underline",!1),color:this.checkAllForStyle(l.ops,"color","rgb(0,0,0)")||"rgb(0,0,0)",isFont:c,font:!1===c?"Oxygen":c.replace(/[\'\"]/g,""),url:g,isUrl:""!==g,isList:"OL"===a[p].parentElement.nodeName,isBullet:"UL"===a[p].parentElement.nodeName,isLeft:!!VGLibrary.quill.instance.container&&"left"===VGLibrary.quill.instance.container.style.textAlign,isCenter:!!VGLibrary.quill.instance.container&&"center"===VGLibrary.quill.instance.container.style.textAlign,isRight:!!VGLibrary.quill.instance.container&&"right"===VGLibrary.quill.instance.container.style.textAlign,isJustify:!!VGLibrary.quill.instance.container&&"justify"===VGLibrary.quill.instance.container.style.textAlign}}return"LI"===a[a.length-1].nodeName&&(a[a.length-1].innerText=a[a.length-1].innerText.replace(/\n/g,""),""===a[a.length-1].innerText&&(t[s=Object.keys(t).length]=t[s-1])),t},VGLibrary.quill.checkForMultipleBlockStyles=function(){for(var e=0;e<VGLibrary.quill.instance.root.childNodes.length;e++)if("DIV"!==VGLibrary.quill.instance.root.childNodes[e].nodeName)return 0<e;return!1},VGLibrary.quill.prepareStylesForNewLine=function(e){var t=this.checkAllForStyle(e.ops,"bold",!1),i=this.checkAllForStyle(e.ops,"italic",!1),a=this.checkAllForStyle(e.ops,"underline",!1),o=this.checkAllForStyle(e.ops,"color","rgb(0,0,0)")||"rgb(0,0,0)",r=this.checkAllForStyle(e.ops,"font","Oxygen"),n=!1===r?"Oxygen":r.replace(/[\'\"]/g,"");this.checkAllForStyle(e.ops,"link",!1);!0===t&&this.setStyle("bold",!0),!0===i&&this.setStyle("italic",!0),!0===a&&this.setStyle("underline",!0),void 0!==o&&""!==o&&this.setStyle("color",o),r&&this.setStyle("font",n)},VGLibrary.quill.disableToolbarSelection=function(){$('#ReactSettingsToolbar [data-toggle="tooltip"]:not([data-original-title="Link"])').disableSelection(),$('#ReactSettingsToolbar [data-original-title="Link"]').find(">:first-child>:first-child")[0]&&$('#ReactSettingsToolbar [data-original-title="Link"]').find(">:first-child>:first-child").disableSelection()},VGLibrary.quill.enableLink=function(e){void 0!==e&&""!==e&&(e=e.match(/^https?:\/\/|^mailto:/)?e:"http://"+e,this.selection&&this.selection.start===this.selection.end&&this.expandLinkSelection(),this.setStyle("link",e),this.setStyle("color","#2D95EC"))},VGLibrary.quill.disableLink=function(){this.selection&&this.selection.start===this.selection.end&&this.expandLinkSelection(),this.container.find("a").removeAttr("rel"),this.setStyle("link",!1)},VGLibrary.quill.expandLinkSelection=function(){var e=this.instance.editor.doc.findLeafAt(this.selection.start,!0),t=e[0],i=e[1],a=this.selection.start-i,o=a+t.length;this.selection={start:a,end:o}},VGLibrary.quill.getAllFonts=function(e){if(e.length<1)return[];for(var t=[],i=0;i<e.length;i++)e[i].attributes&&e[i].attributes.font&&t.indexOf(e[i].attributes.font)<0&&t.push(e[i].attributes.font.replace(/['"]+/g,""));return t},VGLibrary.quill.checkAllForStyle=function(e,t,i){if(e.length<1)return!1;var a=i;if(e[0].attributes&&void 0!==e[0].attributes[t]&&(a=e[0].attributes[t]),1===e.length)return a;for(var o=0;o<e.length;o++)if((!e[o].insert||!/^[\n\s]+$/.test(e[o].insert))&&(!e[o].attributes&&"font"!==t||!e[o].attributes&&"font"===t&&"Oxygen"!==a||e[o].attributes&&e[o].attributes[t]!==a))return!1;return a},VGLibrary.quill.setStyle=function(e,t){var i=$(this.instance.root),a=$.extend(!0,{},page.activeWidget.data);if(VGLibrary.quill.currentTextWidgetID){if("color"===e&&this.checkBadColor(t)&&(t=null),0<i.find("ul, ol").length&&Viz.isPropertyExist(page.activeWidget,"data.settings.general.list_styles.list_color")&&Viz.isPropertyExist(page.activeWidget,"data.settings.general.list_styles.list_font")&&("color"===e||"font"===e)&&this.selection){this.selectionRange={start:0,end:this.instance.getLength()-1};var o=this.selection.end-this.selection.start,r=this.selectionRange.end-this.selectionRange.start,n=Math.abs(o-r);if(o==r||n<2)switch(e){case"color":a.settings.general.list_styles.list_color=t,Viz.eventBus.shout(page.activeWidget,page.activeWidget.typeOf+".load",a),i.find("ul, ol").css(e,t);break;case"font":a.settings.general.list_styles.list_font=t,Viz.eventBus.shout(page.activeWidget,page.activeWidget.typeOf+".load",a),i.find("ul, ol").css(e,t)}}if("block"!==this.container.css("display")||"list"!==e&&"bullet"!==e||(this.selection={start:0,end:this.instance.getLength()},this.instance.formatText(this.selection.start,this.selection.end,e,t),this.updateListStyle(i,"color"),this.updateListStyle(i,"font"),this.updateToolbarUI()),"none"===this.container.css("display")){switch(this.selection={start:0,end:this.instance.getLength()},this.instance.formatText(this.selection.start,this.selection.end,e,t),e){case"color":this.updateListStyle(i,"color"),this.fixUnderlineColor();break;case"font":this.updateListStyle(i,"font");break;case"list":case"bullet":this.updateListStyle(i,"font"),this.updateListStyle(i,"color")}return $(page.widget_map[VGLibrary.quill.currentTextWidgetID]).find("#new_text_widget_v4").html(this.instance.getHTML()),page.widget_map[VGLibrary.quill.currentTextWidgetID].resizeText(),window.clearTimeout(this.widgetSaveTimeout),this.widgetSaveTimeout=window.setTimeout(function(){VGEditor.setting.save(page.widget_map[VGLibrary.quill.currentTextWidgetID])},500),void VGLibrary.quill.updateToolbarUI()}if(this.selection&&this.selection.start!==this.selection.end||"link"===e)this.instance.formatText(this.selection.start,this.selection.end,e,t),"color"===e&&this.fixUnderlineColor(),this.updateToolbarUI(),this.focusSelection();else{switch(this.focusSelection(),this.instance.prepareFormat(e,t),e){case"bold":this.currentTextProps.isBold=t;break;case"italic":this.currentTextProps.isItalic=t;break;case"underline":this.currentTextProps.isUnderline=t;break;case"color":this.currentTextProps.color=t;break;case"font":this.currentTextProps.isFont=t,this.currentTextProps.font=t.replace(/\'/g,"");break;case"list":this.currentTextProps.isList=t;break;case"bullet":this.currentTextProps.isBullet=t}VGEditor.setting.updateQuill(this.currentTextProps)}page.widget_map[VGLibrary.quill.currentTextWidgetID].resizeText()}},VGLibrary.quill.checkBadColor=function(e){e=e.replace(/\s/g,"");for(var t=["rgba(0,0,0,1)","rgb(0,0,0)","#000000","#000"],i=0;i<t.length;i++)if(t[i]===e)return!0;return!1},VGLibrary.quill.fixUnderlineColor=function(){for(var e,t,i=0,a=this.instance.getContents(0,this.instance.getLength()-1).ops,o=0;o<a.length;o++){a[o].attributes&&!0===a[o].attributes.underline&&a[o].insert&&(t=(e=i)+a[o].insert.length,this.instance.formatText(e,t,"underline",!1),this.instance.formatText(e,t,"underline",!0)),a[o].insert&&(i+=a[o].insert.length)}},VGLibrary.quill.updateListStyle=function(e,t){var i,a=this.instance.getContents(0,this.instance.getLength()-1).ops,o=$.extend(!0,{},page.activeWidget.data);if(a.length){a[0].attributes&&void 0!==a[0].attributes[t]&&(i=a[0].attributes[t]);for(var r=0;r<a.length;r++)if((!a[r].insert||!/^[\n\s]+$/.test(a[r].insert))&&a[r].attributes&&a[r].attributes[t]&&a[r].attributes[t]!==i)return!1;if(0<e.find("ul, ol").length&&Viz.isPropertyExist(page.activeWidget,"data.settings.general.list_styles.list_color")&&Viz.isPropertyExist(page.activeWidget,"data.settings.general.list_styles.list_font")){var n="font"===t?"font-family":"color";switch(t){case"color":o.settings.general.list_styles.list_color=i,Viz.eventBus.shout(page.activeWidget,page.activeWidget.typeOf+".load",o),e.find("ul, ol").css(n,i);break;case"font":o.settings.general.list_styles.list_font=i.replace(/\'/g,""),Viz.eventBus.shout(page.activeWidget,page.activeWidget.typeOf+".load",o),e.find("ul, ol").css(n,i)}}}},VGLibrary.quill.isInEditMode=function(){return"block"===this.container.css("display")},VGLibrary.quill.hideEditor=function(){this.instance.setSelection(null),this.container.hide()},$.ui.ddmanager.prepareOffsets=function(e,t){var i,a,o=$.ui.ddmanager.droppables[e.options.scope]||[],r=t?t.type:null,n=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();e:for(i=0;i<o.length;i++)if(!(o[i].options.disabled||e&&!o[i].accept.call(o[i].element[0],e.currentItem||e.element))){for(a=0;a<n.length;a++)if(n[a]===o[i].element[0]){o[i].proportions().height=0;continue e}o[i].visible="none"!==o[i].element.css("display"),o[i].visible&&("mousedown"===r&&o[i]._activate.call(o[i],t),o[i].offset=o[i].element.offset(),o[i].proportions({width:o[i].element[0].offsetWidth*(zoom_percent/100),height:o[i].element[0].offsetHeight*(zoom_percent/100)}))}},disableTopActionBar=function(){$(".right-click-menu").addClass("disabled")},enableTopActionBar=function(){$(".right-click-menu").removeClass("disabled")},reInitSideBar=e,$("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_share, #other_controls_download, #other_controls_settings, #main_controls_resize, #main_controls_file").on("click",">a,>button",function(e){var t,i;0<$(this).parents("#ReactSettingsExport").length||($("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_share, #other_controls_download, #other_controls_settings, #main_controls_resize, #main_controls_file").tooltip("enable"),"social-twitter"==(t=$(this).attr("class"))||"social-facebook"===t||"social-tumblr"===t||"social-reddit"===t||"social-linkedin"===t||"social-pinterest"===t||"publish-link"===t||"publish-link btn btn-green btn-block"===t||"upgrade-to-premium"===t||(e.stopPropagation(),e.preventDefault(),i=$(this).parent().hasClass("open"),$("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_share, #other_controls_download, #other_controls_settings, #main_controls_resize, #main_controls_file").removeClass("open"),i||($(this).parent().tooltip("disable"),$(this).parent().addClass("open"))))}),$(".settings-transparent-layer").on("click",function(e){$("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_share, #other_controls_download, #other_controls_settings, #main_controls_resize, #main_controls_file").removeClass("open")}),$("#editor_nav").on("click","a",function(e){e.preventDefault()}),$("#editor").on("click.othercontrols",function(e){$("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_share, #other_controls_download, #other_controls_settings").tooltip("enable"),$(e.target).closest("#other_controls_nodes").length?$("#other_controls_publish, #other_controls_share, #other_controls_download, #other_controls_settings").removeClass("open"):$(e.target).closest("#other_controls_publish").length?$("#other_controls_test, #other_controls_nodes, #other_controls_share, #other_controls_download, #other_controls_settings").removeClass("open"):$(e.target).closest("#other_controls_share").length?$("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_download, #other_controls_settings").removeClass("open"):$(e.target).closest("#other_controls_download").length?$("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_share,#other_controls_settings").removeClass("open"):$(e.target).closest("#other_controls_settings").length?$("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_share, #other_controls_download").removeClass("open"):$("#other_controls_test, #other_controls_nodes, #other_controls_publish, #other_controls_share, #other_controls_download, #other_controls_settings").removeClass("open")}),$("#widget_container").on("click","a.hyperlink-widget",function(e){e.preventDefault()}),$(".editor-top-level-menu").on("click",function(){$(this).parent().hasClass("open")&&($("#editor_nav .side-menu-container").scrollTop(this.getBoundingClientRect().top-document.querySelector("#editor_nav .side-menu-container").getBoundingClientRect().top),iconLoader.currentSearch="",O.find("ul.dropdown-menu").html("").hide())}),window.showLoading=M,window.removeLoading=F,window.runTour=function(){var a=new Tour({onEnd:function(e){$.ajax({type:"post",url:"/users/disable_tour/3",dataType:"text",success:function(e){},error:function(e){console.log(e)}}),tour_on=0,VGEditor.track.mixpanel("Finish Editor Tour Guide",{step:e._state.current_step,tourGuideVersion:"experiment-1"})},onShown:function(i){$("#editor_nav").on("click",".widget-draggable",function(){1==i._current&&a.goTo(2)}),$("#widget_container").on("drop",function(e,t){1==i._current&&setTimeout(function(){a.goTo(2)},500)}),$("#hide_menu_btn").on("click",function(){1==i._current&&a.goTo(1)}),$("#other_controls_test,  a, #other_controls_publish a, #other_controls_share a, #other_controls_download a, #other_controls_settings a").on("click",function(e,t){4==i._current&&a.goTo(5)})},storage:!1});setTimeout(function(){var e=$("#widget_container .ui-draggable").first();$("#widget_container .ui-draggable").each(function(){($(this).offset().top<$(window).height()||$(this).offset().top<e.offset().top)&&(e=$(this))});var t=[{element:!1,title:window.__vg_translator.t("editor.tour_guide.intro.title"),content:window.__vg_translator.t("editor.tour_guide.intro.content"),template:"<div class='popover tour tourguide step-0'>                             <button data-role='end' title='End Tour' class='skip-tour-button' data-vg-test-label='editor-tour-btn-skip'>"+window.__vg_translator.t("editor.tour_guide.skip")+"</button>                             <h3 class='popover-title' style='margin-top: 50px;'></h3>                             <div class='popover-content'></div>                             <div class='popover-navigation'>                             <button class='btn btn-green' data-role='next'>"+window.__vg_translator.t("editor.tour_guide.start")+"</button>                             </div>                             </div>",animation:!1,backdrop:!0,orphan:!0},{element:"#editor_nav",title:window.__vg_translator.t("editor.tour_guide.widgets.title"),content:window.__vg_translator.t("editor.tour_guide.widgets.content"),template:"<div class='popover tour tourguide step-1'>                             <button data-role='end' title='End Tour' class='skip-tour-button'>"+window.__vg_translator.t("editor.tour_guide.skip")+"</button>                             <div class='popover-progress'><span class='progress-done'></span><span></span><span></span><span></span><span></span></div>                             <h3 class='popover-title'></h3>                             <div class='popover-content'></div>                             <div class='popover-navigation'>                             <button class='btn btn-green' data-role='next'>"+window.__vg_translator.t("editor.tour_guide.next")+"</button>                             </div>                             <img src='/media/v2_img/tour/arrow1.png' class='arrow-graphic'/>                             </div>",placement:"right",animation:!1},{element:"#infographic",title:window.__vg_translator.t("editor.tour_guide.edit.title"),content:window.__vg_translator.t("editor.tour_guide.edit.content"),template:"<div class='popover tour tourguide step-2'>                             <button data-role='end' title='End Tour' class='skip-tour-button'>"+window.__vg_translator.t("editor.tour_guide.skip")+"</button>                             <div class='popover-progress'><span class='progress-done'></span><span class='progress-done'></span><span></span><span></span><span></span></div>                             <h3 class='popover-title'></h3>                             <div class='popover-content'></div>                             <div class='popover-navigation'>                             <button class='btn btn-gray' data-role='prev'>"+window.__vg_translator.t("editor.tour_guide.previous")+"</button>                             <button class='btn btn-green' data-role='next'>"+window.__vg_translator.t("editor.tour_guide.next")+"</button>                             </div>                             <img src='/media/v2_img/tour/arrow2.png' class='arrow-graphic'/>                             </div>",placement:"left",animation:!1},{element:"#widget_static_tool_container .layer_trigger",title:window.__vg_translator.t("editor.tour_guide.toolbar.title"),content:window.__vg_translator.t("editor.tour_guide.toolbar.content"),template:"<div class='popover tour tourguide step-3'>                             <button data-role='end' title='End Tour' class='skip-tour-button'>"+window.__vg_translator.t("editor.tour_guide.skip")+"</button>                             <div class='popover-progress'><span class='progress-done'></span><span class='progress-done'></span><span class='progress-done'></span><span></span><span></span></div>                             <h3 class='popover-title'></h3>                             <div class='popover-content'></div>                             <div class='popover-navigation'>                             <button class='btn btn-gray' data-role='prev'>"+window.__vg_translator.t("editor.tour_guide.previous")+"</button>                             <button class='btn btn-green' data-role='next'>"+window.__vg_translator.t("editor.tour_guide.next")+"</button>                             </div>                             <img src='/media/v2_img/tour/arrow3.png' class='arrow-graphic' />                             </div>",placement:"bottom",animation:!1},{element:"#other_controls",title:window.__vg_translator.t("editor.tour_guide.download.title"),content:window.__vg_translator.t("editor.tour_guide.download.content"),template:"<div class='popover tour tourguide step-4'>                             <button data-role='end' title='End Tour' class='skip-tour-button'>"+window.__vg_translator.t("editor.tour_guide.skip")+"</button>                             <div class='popover-progress'><span class='progress-done'></span><span class='progress-done'></span><span class='progress-done'></span><span class='progress-done'></span><span></span></div>                             <h3 class='popover-title'></h3>                             <div class='popover-content'></div>                             <div class='popover-navigation'>                             <button class='btn btn-gray' data-role='prev'>"+window.__vg_translator.t("editor.tour_guide.previous")+"</button>                             <button class='btn btn-green' data-role='next'>"+window.__vg_translator.t("editor.tour_guide.next")+"</button>                             </div>                             <img src='/media/v2_img/tour/arrow4.png' class='arrow-graphic' />                             </div>",placement:"bottom",animation:!1},{element:"#main-venngage-nav-menu #navbar-help-btn",title:window.__vg_translator.t("editor.tour_guide.help.title"),content:window.__vg_translator.t("editor.tour_guide.help.content",{href:"http://support.venngage.com/article/26-do-you-have-any-tutorials",target:"_blank"}),template:"<div class='popover tour tourguide step-5'>                             <div class='popover-progress'><span class='progress-done'></span><span class='progress-done'></span><span class='progress-done'></span><span class='progress-done'></span><span class='progress-done'></span></div>                             <h3 class='popover-title'></h3>                             <div class='popover-content'></div>                             <div class='popover-navigation'>                             <button class='btn btn-gray' data-role='prev'>"+window.__vg_translator.t("editor.tour_guide.previous")+"</button>                             <button class='btn btn-green' data-role='end'>"+window.__vg_translator.t("editor.tour_guide.done")+"</button>                             </div>                             <img src='/media/v2_img/tour/arrow5.png' class='arrow-graphic' />                             </div>",placement:"bottom",animation:!1}];a.addSteps(t),a.init(),a.restart()},500)},$('[data-toggle="tooltip"]').tooltip();var N=$("#toggle_group_widget");groupOverlay.registerNotification(function(){for(var e=!1,t=0;t<page.selected.length&&!(e=page.widget_map[page.selected[t]]&&"viz.widget.reactWrapper"===page.widget_map[page.selected[t]].typeOf);t++);var i=window.__vg_translator.t("editor.static.group"),a=window.__vg_translator.t("editor.static.ungroup");e||(!this.isHidden()&&groupOverlay.isWidgetsInSameGroup()&&0!=groupOverlay.largestActiveGroupId()?(N.addClass("v-tool-group-icon-highlight").attr("data-original-title",a),this.$element.addClass("v-ungroupable")):(N.removeClass("v-tool-group-icon-highlight").attr("data-original-title",i),this.$element.removeClass("v-ungroupable"))),N.css(!(1<page.selected.length)||e?{opacity:.2,cursor:"default"}:{opacity:1,cursor:"pointer"}).data("disabled",e),page.updateMentuToolUI()}),N.on("click",function(e){for(var t=0;t<page.selected.length;t++)if("viz.widget.reactWrapper"===page.widget_map[page.selected[t]].typeOf)return;$(this);e.preventDefault(),1<page.selected.length&&(groupOverlay.setPage(page),groupOverlay.isWidgetsInSameGroup()?0==groupOverlay.largestActiveGroupId()?(page.groupWidgets(null,null),VGEditor.track.mixpanel("Clicked on group",{type:"Group"})):(page.ungroupWidgets(null),VGEditor.track.mixpanel("Clicked on group",{type:"Ungroup"})):page.groupWidgets(null,null),groupOverlay.show())}),VGEditor.brand=new VBrand({bucketPrivder:{bucketName:brandMediaBucket}}),initFavouritesIcons(),VGEditor.autoConvertShapv4BoundingBox=function(g){var e=$.Deferred(),p=[];return g&&$.each(g.widget_map,function(e,t){var i,a,o,r,n,s,d,l,c;/^viz.widget.standard.shapev4/i.test(t.typeOf)&&t.data.icon&&((i=VGLibrary.icons[t.data.icon])&&i.viewBox&&!t.data.viewBox&&(a=$(i.svg),$(t),o=a[0].getAttribute("viewBox").split(" "),r=i.viewBox.split(" "),o.length===r.length&&(n=Math.max(parseFloat(o[2]),parseFloat(o[3])),s=Math.max(parseFloat(r[2]),parseFloat(r[3])),d=Math.min(t.dimension.width,t.dimension.height)*s/n/s,l=r[2]*d,c=r[3]*d,t.data.viewBox=i.viewBox,t.dimension.x+=(t.dimension.width-l)/2,t.dimension.y+=(t.dimension.height-c)/2,t.dimension.width=l,t.dimension.height=c,$(t).css({left:t.dimension.x+"px",top:t.dimension.y+"px",width:t.dimension.width+"px",height:t.dimension.height+"px"}),Viz.eventBus.shout(t,"viz.widget.standard.shapev4.load",t.data),p.push(g.getChildWidgetRawData(t.identifier)))))}),setTimeout(function(){e.resolve(p)},200),e.promise()},VGEditor.forceToSavePage=function(t,e){e&&VGEditor.historyManagement&&(VGEditor.historyManagement.resetHistory(),VGEditor.historyManagement.commit(VGEditor.getCurrentPageData()),VGEditor.historyManagement.publish("commit")),t&&"function"==typeof t.getRawData&&"function"==typeof t.saveAll&&t.saveAll(t.getRawData(),function(e){"done"===e&&VGEditor.collaboration&&VGEditor.collaboration.isRTCEnabled()&&VGEditor.collaboration.initLoadPage(t.identifier,{},loadingError)})}});